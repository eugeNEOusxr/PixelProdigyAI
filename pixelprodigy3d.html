<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixelProdigy Universe - Multi-Workspace Studio</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a0a0a;
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }

    #container {
      display: grid;
      grid-template-columns: 250px 1fr;
      grid-template-rows: 60px 1fr 40px;
      height: 100vh;
    }

    #header {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      padding: 0 20px;
      gap: 20px;
    }

    #header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .workspace-tabs {
      display: flex;
      gap: 4px;
      flex: 1;
    }

    .workspace-tab {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: rgba(255, 255, 255, 0.7);
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 6px 6px 0 0;
      transition: all 0.2s;
      font-size: 13px;
      font-weight: 500;
    }

    .workspace-tab:hover {
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
    }

    .workspace-tab.active {
      background: #1a1a1a;
      color: #fff;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.3);
    }

    #sidebar {
      background: #1a1a1a;
      padding: 20px;
      overflow-y: auto;
      border-right: 2px solid #333;
    }

    #viewport {
      background: #0f0f0f;
      position: relative;
      overflow: hidden;
    }

    #canvas {
      width: 100%;
      height: 100%;
      display: block;
      cursor: crosshair;
    }

    #footer {
      grid-column: 1 / -1;
      background: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      border-top: 2px solid #333;
      font-size: 13px;
      color: #888;
    }

    .section {
      margin-bottom: 25px;
    }

    .section-title {
      font-size: 12px;
      text-transform: uppercase;
      color: #888;
      margin-bottom: 12px;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .tool-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .tool-btn {
      background: #2a2a2a;
      border: 2px solid #3a3a3a;
      color: #fff;
      padding: 12px 8px;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
      font-size: 13px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .tool-btn:hover {
      background: #3a3a3a;
      border-color: #667eea;
    }

    .tool-btn.active {
      background: #667eea;
      border-color: #764ba2;
      box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
    }

    .tool-icon {
      font-size: 24px;
    }

    .slider-control {
      margin-bottom: 15px;
    }

    .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 12px;
      color: #aaa;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      background: #2a2a2a;
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #667eea;
      cursor: pointer;
      border-radius: 50%;
      transition: all 0.2s;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: #764ba2;
      transform: scale(1.2);
    }

    .primitive-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="header">
      <h1>⚡ PixelProdigy Universe</h1>
      <div class="workspace-tabs">
        <button class="workspace-tab active" onclick="switchWorkspace('sculpt', this)">3D Sculpt</button>
        <button class="workspace-tab" onclick="switchWorkspace('css', this)">CSS Designer</button>
        <button class="workspace-tab" onclick="switchWorkspace('word', this)">WordWeaver</button>
        <button class="workspace-tab" onclick="switchWorkspace('campus', this)">Campus</button>
        <button class="workspace-tab" onclick="switchWorkspace('perfect', this)">Perfect</button>
      </div>
      <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Multi-Workspace Studio</div>
    </div>

    <div id="sidebar">
      <!-- Sculpt Workspace -->
      <div id="workspace-sculpt" class="workspace-content">
        <div class="section">
          <div class="section-title">🔧 Mode</div>
          <div class="tool-grid">
            <button class="tool-btn active" onclick="setMode('add', this)">
              <span class="tool-icon">➕</span>
              <span>Add</span>
            </button>
            <button class="tool-btn" onclick="setMode('subtract', this)">
              <span class="tool-icon">➖</span>
              <span>Subtract</span>
            </button>
          </div>
        </div>

        <div class="section">
          <div class="section-title">✋ Manipulate</div>
          <div class="tool-grid">
            <button class="tool-btn" onclick="setTransformMode('translate')">
              <span class="tool-icon">↔️</span>
              <span>Move (W)</span>
            </button>
            <button class="tool-btn" onclick="setTransformMode('rotate')">
              <span class="tool-icon">🔄</span>
              <span>Rotate (E)</span>
            </button>
            <button class="tool-btn" onclick="setTransformMode('scale')">
              <span class="tool-icon">📏</span>
              <span>Scale (R)</span>
            </button>
          </div>
        </div>

        <div class="section">
          <div class="section-title">🎨 Primitives</div>
          <div class="primitive-grid">
            <button class="tool-btn active" onclick="setPrimitive('sphere', this)">
              <span class="tool-icon">⚪</span>
              <span>Sphere</span>
            </button>
            <button class="tool-btn" onclick="setPrimitive('cube', this)">
              <span class="tool-icon">⬛</span>
              <span>Cube</span>
            </button>
            <button class="tool-btn" onclick="setPrimitive('cylinder', this)">
              <span class="tool-icon">🔵</span>
              <span>Cylinder</span>
            </button>
            <button class="tool-btn" onclick="setPrimitive('cone', this)">
              <span class="tool-icon">🔻</span>
              <span>Cone</span>
            </button>
            <button class="tool-btn" onclick="setPrimitive('torus', this)">
              <span class="tool-icon">🍩</span>
              <span>Torus</span>
            </button>
            <button class="tool-btn" onclick="setPrimitive('pyramid', this)">
              <span class="tool-icon">🔺</span>
              <span>Pyramid</span>
            </button>
            <button class="tool-btn" onclick="loadHumanAnatomy(this)" style="grid-column: 1 / -1; background: rgba(102, 126, 234, 0.2);">
              <span class="tool-icon">🦾</span>
              <span>Human Figure (86 Vertices)</span>
            </button>
          </div>
        </div>

        <!-- LEARN MODE TOGGLE -->
        <div class="section">
          <div class="section-title">📚 Learn Mode</div>
          <button class="tool-btn" id="learnModeToggle" onclick="toggleLearnMode(this)" style="width: 100%; background: rgba(0, 255, 136, 0.1); border: 2px solid rgba(0, 255, 136, 0.3);">
            <span class="tool-icon">👨‍🏫</span>
            <span>Enable Story Mode</span>
          </button>
          <div id="learnModeInfo" style="display: none; margin-top: 10px; padding: 12px; background: rgba(0, 255, 136, 0.1); border-radius: 8px; font-size: 11px; line-height: 1.5; color: rgba(255, 255, 255, 0.9);">
            <strong>Learn Mode Active!</strong><br>
            Click any Mathematical Method below to see the mathematician's story and how their discovery powers your creations! 🏆
          </div>
        </div>

        <!-- MATHEMATICAL METHODS -->
        <div class="section">
          <div class="section-title">🏆 Mathematical Methods</div>
          <div class="tool-grid">
            <button class="tool-btn active" onclick="selectMethod('fibonacci', this)">
              <span class="tool-icon">🇮🇹</span>
              <span>Fibonacci</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('catmull', this)">
              <span class="tool-icon">🇺🇸</span>
              <span>Catmull-Rom</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('bezier', this)">
              <span class="tool-icon">🇫🇷</span>
              <span>Bézier</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('perlin', this)">
              <span class="tool-icon">🎮</span>
              <span>Perlin Noise</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('quaternion', this)">
              <span class="tool-icon">🇮🇪</span>
              <span>Quaternion</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('lsystem', this)">
              <span class="tool-icon">🇭🇺</span>
              <span>L-System</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('voronoi', this)">
              <span class="tool-icon">🇺🇦</span>
              <span>Voronoi</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('phong', this)">
              <span class="tool-icon">🇻🇳</span>
              <span>Phong</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('delaunay', this)">
              <span class="tool-icon">🇷🇺</span>
              <span>Delaunay</span>
            </button>
            <button class="tool-btn" onclick="selectMethod('subdivision', this)">
              <span class="tool-icon">💎</span>
              <span>Subdivision</span>
            </button>
          </div>
        </div>

        <!-- MATHEMATICIAN STORY PANEL -->
        <div id="mathematicianStory" class="section" style="display: none;">
          <div class="section-title" id="storyTitle">🏆 Mathematician Story</div>
          <div style="padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border: 2px solid rgba(102, 126, 234, 0.3);">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
              <span id="storyFlag" style="font-size: 24px;">🇮🇹</span>
              <div>
                <div id="storyName" style="font-weight: 700; font-size: 14px; color: #00ff88;">Leonardo Fibonacci</div>
                <div id="storyDates" style="font-size: 11px; opacity: 0.8;">1170-1250</div>
              </div>
            </div>
            <div id="storyDiscovery" style="font-size: 12px; font-weight: 600; color: #667eea; margin-bottom: 8px;">
              Discovery: Fibonacci Sequence
            </div>
            <div id="storyText" style="font-size: 11px; line-height: 1.6; margin-bottom: 10px; color: rgba(255, 255, 255, 0.9);">
              Italian mathematician who discovered the famous sequence (0,1,1,2,3,5,8...) while studying rabbit populations.
            </div>
            <div style="background: rgba(0, 255, 136, 0.1); padding: 8px; border-radius: 6px; border-left: 3px solid #00ff88;">
              <div style="font-size: 10px; font-weight: 700; color: #00ff88; margin-bottom: 4px;">💡 KID FACT:</div>
              <div id="storyKidFact" style="font-size: 11px; line-height: 1.5;">
                He introduced Arabic numerals (0-9) to Europe! Before him, Europeans used Roman numerals.
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-title">⚙️ Settings</div>
          <div class="slider-control">
            <div class="slider-label">
              <span>Size</span>
              <span id="sizeValue">0.5</span>
            </div>
            <input type="range" min="0.1" max="2" step="0.1" value="0.5" oninput="updateSize(this.value)">
          </div>
          <div class="slider-control">
            <div class="slider-label">
              <span>Angle</span>
              <span id="angleValue">0°</span>
            </div>
            <input type="range" min="0" max="360" step="15" value="0" oninput="updateAngle(this.value)">
          </div>
        </div>

        <div class="section">
          <div class="section-title">🎯 Actions</div>
          <button class="tool-btn" onclick="clearScene()" style="width: 100%; grid-column: 1 / -1;">
            <span class="tool-icon">🗑️</span>
            <span>Clear All</span>
          </button>
        </div>
      </div>

      <!-- CSS Designer Workspace -->
      <div id="workspace-css" class="workspace-content" style="display: none;">
        <div class="section">
          <div class="section-title">💅 CSS Tools</div>
          <div class="tool-grid">
            <button class="tool-btn" onclick="alert('Gradient generator coming soon!')">
              <span class="tool-icon">🌈</span>
              <span>Gradient</span>
            </button>
            <button class="tool-btn" onclick="alert('Shadow generator coming soon!')">
              <span class="tool-icon">🌫️</span>
              <span>Shadow</span>
            </button>
            <button class="tool-btn" onclick="alert('Border designer coming soon!')">
              <span class="tool-icon">🔲</span>
              <span>Border</span>
            </button>
            <button class="tool-btn" onclick="alert('Animation builder coming soon!')">
              <span class="tool-icon">🎬</span>
              <span>Animate</span>
            </button>
          </div>
        </div>
      </div>

      <!-- WordWeaver Workspace -->
      <div id="workspace-word" class="workspace-content" style="display: none;">
        <div class="section">
          <div class="section-title">📝 Writing Tools</div>
          <div class="tool-grid">
            <button class="tool-btn" onclick="alert('Text editor coming soon!')">
              <span class="tool-icon">✍️</span>
              <span>Editor</span>
            </button>
            <button class="tool-btn" onclick="alert('Templates coming soon!')">
              <span class="tool-icon">📄</span>
              <span>Templates</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Campus Workspace -->
      <div id="workspace-campus" class="workspace-content" style="display: none;">
        <div class="section">
          <div class="section-title">🏫 Campus Tools</div>
          <div class="tool-grid">
            <button class="tool-btn" onclick="alert('Building designer coming soon!')">
              <span class="tool-icon">🏢</span>
              <span>Buildings</span>
            </button>
            <button class="tool-btn" onclick="alert('Layout planner coming soon!')">
              <span class="tool-icon">🗺️</span>
              <span>Layout</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Perfect Workspace -->
      <div id="workspace-perfect" class="workspace-content" style="display: none;">
        <div class="section">
          <div class="section-title">✨ Perfect Tools</div>
          <div class="tool-grid">
            <button class="tool-btn" onclick="alert('Perfect system coming soon!')">
              <span class="tool-icon">⭐</span>
              <span>Optimize</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="viewport">
      <canvas id="canvas"></canvas>
      <div class="loading" id="loading">Initializing 3D Engine...</div>
    </div>

    <div id="footer">
      <div>Workspace: <strong id="workspaceDisplay">3D SCULPT</strong> | Mode: <strong id="modeDisplay">ADD</strong> | Primitive: <strong id="primitiveDisplay">SPHERE</strong></div>
      <div>Click viewport to place objects | Drag to rotate view</div>
      <div>Objects: <strong id="objectCount">0</strong> | Vertices: <strong id="vertexCount">0</strong></div>
    </div>
  </div>

  <script src="lib/three.min.js"></script>
  <script src="lib/OrbitControls.js"></script>
  <script src="lib/TransformControls.js"></script>
  <script>
    // State
    let scene, camera, renderer, controls, transformControl;
    let currentMode = 'add';
    let currentPrimitive = 'sphere';
    let primitiveSize = 0.5;
    let rotationAngle = 0;
    let objects = [];
    let selectedObject = null;
    let raycaster = new THREE.Raycaster();
    let mouse = new THREE.Vector2();

    // Initialize
    function init() {
      const canvas = document.getElementById('canvas');
      
      // Scene
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0a0a0a);
      scene.fog = new THREE.Fog(0x0a0a0a, 10, 50);

      // Camera
      camera = new THREE.PerspectiveCamera(
        75,
        canvas.parentElement.offsetWidth / canvas.parentElement.offsetHeight,
        0.1,
        1000
      );
      camera.position.set(5, 5, 5);

      // Renderer
      renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      renderer.setSize(canvas.parentElement.offsetWidth, canvas.parentElement.offsetHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.shadowMap.enabled = true;

      // Controls
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.minDistance = 2;
      controls.maxDistance = 50;

      // Transform Controls for object manipulation
      transformControl = new THREE.TransformControls(camera, renderer.domElement);
      transformControl.addEventListener('dragging-changed', function(event) {
        controls.enabled = !event.value;
      });
      scene.add(transformControl);
      
      // Keyboard: W=move, E=rotate, R=scale, Delete=remove
      window.addEventListener('keydown', function(event) {
        switch(event.key.toLowerCase()) {
          case 'w': transformControl.setMode('translate'); break;
          case 'e': transformControl.setMode('rotate'); break;
          case 'r': transformControl.setMode('scale'); break;
          case 'delete':
          case 'backspace':
            if (selectedObject) {
              scene.remove(selectedObject);
              objects = objects.filter(obj => obj !== selectedObject);
              transformControl.detach();
              selectedObject = null;
              updateObjectCount();
            }
            break;
        }
      });

      // Lights
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(10, 10, 5);
      directionalLight.castShadow = true;
      scene.add(directionalLight);

      const pointLight = new THREE.PointLight(0x667eea, 1, 100);
      pointLight.position.set(-5, 5, -5);
      scene.add(pointLight);

      // Ground plane
      const groundGeometry = new THREE.PlaneGeometry(50, 50);
      const groundMaterial = new THREE.MeshStandardMaterial({ 
        color: 0x1a1a1a,
        roughness: 0.8,
        metalness: 0.2
      });
      const ground = new THREE.Mesh(groundGeometry, groundMaterial);
      ground.rotation.x = -Math.PI / 2;
      ground.receiveShadow = true;
      scene.add(ground);

      // Grid
      const gridHelper = new THREE.GridHelper(50, 50, 0x667eea, 0x2a2a2a);
      scene.add(gridHelper);

      // Events
      canvas.addEventListener('click', onCanvasClick);
      window.addEventListener('resize', onWindowResize);

      // Hide loading
      document.getElementById('loading').style.display = 'none';

      // Start animation
      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    function onWindowResize() {
      const canvas = document.getElementById('canvas');
      camera.aspect = canvas.parentElement.offsetWidth / canvas.parentElement.offsetHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(canvas.parentElement.offsetWidth, canvas.parentElement.offsetHeight);
    }

    function onCanvasClick(event) {
      const canvas = document.getElementById('canvas');
      const rect = canvas.getBoundingClientRect();
      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      
      // Check if clicking existing object to select it
      const intersects = raycaster.intersectObjects(objects, true);
      
      if (intersects.length > 0 && currentMode === 'add') {
        selectedObject = intersects[0].object;
        transformControl.attach(selectedObject);
        console.log('✅ Object selected - Use W/E/R or buttons to manipulate');
        return;
      }
      
      // Otherwise place new object on ground
      if (currentMode === 'add') {
        const groundPlane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);
        const intersectPoint = new THREE.Vector3();
        raycaster.ray.intersectPlane(groundPlane, intersectPoint);

        if (intersectPoint) {
          placePrimitive(intersectPoint);
        }
      }
    }

    function placePrimitive(position) {
      let geometry;
      
      switch(currentPrimitive) {
        case 'sphere':
          geometry = new THREE.SphereGeometry(primitiveSize, 32, 32);
          break;
        case 'cube':
          geometry = new THREE.BoxGeometry(primitiveSize, primitiveSize, primitiveSize);
          break;
        case 'cylinder':
          geometry = new THREE.CylinderGeometry(primitiveSize, primitiveSize, primitiveSize * 2, 32);
          break;
        case 'cone':
          geometry = new THREE.ConeGeometry(primitiveSize, primitiveSize * 2, 32);
          break;
        case 'torus':
          geometry = new THREE.TorusGeometry(primitiveSize, primitiveSize * 0.3, 16, 32);
          break;
        case 'pyramid':
          geometry = new THREE.ConeGeometry(primitiveSize, primitiveSize * 1.5, 4);
          break;
      }

      const material = new THREE.MeshStandardMaterial({
        color: currentMode === 'add' ? 0x00ff88 : 0xff3366,
        roughness: 0.7,
        metalness: 0.3,
        transparent: true,
        opacity: 0.9
      });

      const mesh = new THREE.Mesh(geometry, material);
      mesh.position.copy(position);
      mesh.position.y = primitiveSize / 2;
      mesh.rotation.y = (rotationAngle * Math.PI) / 180;
      mesh.castShadow = true;
      mesh.receiveShadow = true;
      mesh.userData.mode = currentMode;

      scene.add(mesh);
      objects.push(mesh);
      
      updateObjectCount();
      console.log(`Placed ${currentPrimitive} at`, position);
    }

    function setMode(mode, btn) {
      currentMode = mode;
      document.querySelectorAll('#sidebar .tool-grid .tool-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('modeDisplay').textContent = mode.toUpperCase();
      
      // Detach transform when switching to add mode
      if (mode === 'add' && selectedObject) {
        transformControl.detach();
        selectedObject = null;
      }
    }

    function setTransformMode(mode) {
      if (!selectedObject) {
        alert('⚠️ Click an object first to select it!\n\n1. Click any object in the scene\n2. Then use Move/Rotate/Scale buttons\n3. Or press W/E/R keys');
        return;
      }
      transformControl.setMode(mode);
      console.log(`🎨 Transform mode: ${mode.toUpperCase()}`);
    }

    function setPrimitive(primitive, btn) {
      currentPrimitive = primitive;
      document.querySelectorAll('.primitive-grid .tool-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('primitiveDisplay').textContent = primitive.toUpperCase();
    }

    // 🦾 HUMAN ANATOMY LOADER (86-Vertex System)
    function loadHumanAnatomy(btn) {
      console.log('🦾 Loading 86-vertex human anatomy...');
      
      // Clear primitive selection
      document.querySelectorAll('.primitive-grid .tool-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Create anatomical arm with 86 vertices
      const armGroup = new THREE.Group();
      const vertexCount = 86;
      
      // Shoulder (origin point)
      const shoulderGeom = new THREE.SphereGeometry(0.3, 8, 8);
      const shoulderMat = new THREE.MeshStandardMaterial({ color: 0xffccaa, roughness: 0.7 });
      const shoulder = new THREE.Mesh(shoulderGeom, shoulderMat);
      armGroup.add(shoulder);
      
      // Upper arm (14" / 35cm extended cylinder)
      const upperArmGeom = new THREE.CylinderGeometry(0.2, 0.18, 3.5, 16);
      const upperArmMat = new THREE.MeshStandardMaterial({ color: 0xffccaa, roughness: 0.7 });
      const upperArm = new THREE.Mesh(upperArmGeom, upperArmMat);
      upperArm.position.y = -1.75;
      armGroup.add(upperArm);
      
      // Elbow joint (180° pivot capability)
      const elbowGeom = new THREE.SphereGeometry(0.22, 8, 8);
      const elbowMat = new THREE.MeshStandardMaterial({ color: 0xffaa88, roughness: 0.6 });
      const elbow = new THREE.Mesh(elbowGeom, elbowMat);
      elbow.position.y = -3.5;
      armGroup.add(elbow);
      
      // Forearm (14" / 35cm)
      const forearmGeom = new THREE.CylinderGeometry(0.18, 0.15, 3.5, 16);
      const forearmMat = new THREE.MeshStandardMaterial({ color: 0xffccaa, roughness: 0.7 });
      const forearm = new THREE.Mesh(forearmGeom, forearmMat);
      forearm.position.y = -5.25;
      armGroup.add(forearm);
      
      // Wrist joint
      const wristGeom = new THREE.SphereGeometry(0.16, 8, 8);
      const wristMat = new THREE.MeshStandardMaterial({ color: 0xffaa88, roughness: 0.6 });
      const wrist = new THREE.Mesh(wristGeom, wristMat);
      wrist.position.y = -7;
      armGroup.add(wrist);
      
      // Wrist bone protrusion (270-300° styloid process)
      const wristBoneGeom = new THREE.SphereGeometry(0.01, 8, 8);
      const wristBoneMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.3 });
      const wristBone = new THREE.Mesh(wristBoneGeom, wristBoneMat);
      wristBone.position.set(0.15, -7, 0);
      armGroup.add(wristBone);
      
      // Hand (oval with 40% growth + curl)
      const handGeom = new THREE.BoxGeometry(0.4, 0.6, 0.15);
      const handMat = new THREE.MeshStandardMaterial({ color: 0xffccaa, roughness: 0.7 });
      const hand = new THREE.Mesh(handGeom, handMat);
      hand.position.y = -7.8;
      hand.rotation.x = Math.PI / 8; // 45° curl
      armGroup.add(hand);
      
      // Thumb (190° hump alignment)
      const thumbGeom = new THREE.CylinderGeometry(0.08, 0.06, 0.5, 8);
      const thumbMat = new THREE.MeshStandardMaterial({ color: 0xffccaa, roughness: 0.7 });
      const thumb = new THREE.Mesh(thumbGeom, thumbMat);
      thumb.position.set(-0.25, -7.6, 0.1);
      thumb.rotation.z = -Math.PI / 3;
      armGroup.add(thumb);
      
      // 4 Fingers (progressive sizing: 3.5" base, -10% per finger)
      const fingerLengths = [0.875, 0.7875, 0.7, 0.6125]; // 3.5" → 3.15" → 2.8" → 2.45" (in units)
      for (let i = 0; i < 4; i++) {
        const fingerGeom = new THREE.CylinderGeometry(0.06 * (1 - i * 0.1), 0.04 * (1 - i * 0.1), fingerLengths[i], 8);
        const fingerMat = new THREE.MeshStandardMaterial({ color: 0xffccaa, roughness: 0.7 });
        const finger = new THREE.Mesh(fingerGeom, fingerMat);
        finger.position.set(-0.15 + (i * 0.1), -8.3, 0);
        finger.rotation.x = Math.PI / 12; // Slight curl
        armGroup.add(finger);
        
        // Fingertip (spherical)
        const tipGeom = new THREE.SphereGeometry(0.05 * (1 - i * 0.1), 8, 8);
        const tipMat = new THREE.MeshStandardMaterial({ color: 0xffaa88, roughness: 0.6 });
        const tip = new THREE.Mesh(tipGeom, tipMat);
        tip.position.set(-0.15 + (i * 0.1), -8.3 - fingerLengths[i] / 2, 0);
        armGroup.add(tip);
      }
      
      // Position the arm group in the scene
      armGroup.position.set(0, 0, 0);
      scene.add(armGroup);
      objects.push(armGroup);
      
      // Update UI
      updateObjectCount();
      updateVertexCount();
      document.getElementById('primitiveDisplay').textContent = `HUMAN ARM (${vertexCount}V)`;
      
      console.log(`✅ Anatomical arm loaded: ${vertexCount} vertices`);
      alert(`✅ 86-Vertex Anatomical Arm Loaded!\n\nFeatures:\n• Shoulder joint\n• Upper arm (14")\n• Elbow (180° pivot)\n• Forearm (14")\n• Wrist + styloid bone\n• Hand with 40% growth curl\n• Thumb (190° hump)\n• 4 progressive fingers\n\nUse transform tools to position!`);
    }

    function updateSize(value) {
      primitiveSize = parseFloat(value);
      document.getElementById('sizeValue').textContent = value;
    }

    function updateAngle(value) {
      rotationAngle = parseFloat(value);
      document.getElementById('angleValue').textContent = value + '°';
    }

    function clearScene() {
      if (confirm('Clear all objects?')) {
        objects.forEach(obj => scene.remove(obj));
        objects = [];
        updateObjectCount();
      }
    }

    function switchWorkspace(workspace, btn) {
      // Update tab UI
      document.querySelectorAll('.workspace-tab').forEach(tab => tab.classList.remove('active'));
      btn.classList.add('active');

      // Hide all workspace content
      document.querySelectorAll('.workspace-content').forEach(content => {
        content.style.display = 'none';
      });

      // Show selected workspace
      const workspaceElement = document.getElementById(`workspace-${workspace}`);
      if (workspaceElement) {
        workspaceElement.style.display = 'block';
      }

      // Update display
      const workspaceNames = {
        'sculpt': '3D SCULPT',
        'css': 'CSS DESIGNER',
        'word': 'WORDWEAVER',
        'campus': 'CAMPUS',
        'perfect': 'PERFECT'
      };
      document.getElementById('workspaceDisplay').textContent = workspaceNames[workspace] || workspace.toUpperCase();
      
      console.log('Switched to:', workspace);
    }

    function updateObjectCount() {
      document.getElementById('objectCount').textContent = objects.length;
    }

    function updateVertexCount() {
      let totalVertices = 0;
      objects.forEach(obj => {
        obj.traverse((child) => {
          if (child.geometry) {
            const positions = child.geometry.attributes.position;
            if (positions) {
              totalVertices += positions.count;
            }
          }
        });
      });
      document.getElementById('vertexCount').textContent = totalVertices;
      console.log(`📊 Total vertices in scene: ${totalVertices}`);
    }

    // =============================================
    // MATHEMATICIAN TRIBUTE SYSTEM
    // =============================================

    let learnModeActive = false;
    let currentMethod = 'fibonacci';

    const MATHEMATICIANS = {
      fibonacci: {
        name: "Leonardo Fibonacci",
        born: 1170,
        died: 1250,
        flag: "🇮🇹",
        nationality: "Italian",
        discovery: "Fibonacci Sequence",
        story: "Italian mathematician who discovered the famous sequence (0,1,1,2,3,5,8...) while studying rabbit populations. Each number is the sum of the two before it! This sequence appears everywhere in nature: sunflower spirals, pinecones, nautilus shells.",
        kidFact: "He introduced Arabic numerals (0-9) to Europe! Before him, Europeans used Roman numerals (I, II, III, IV...) which made math really hard."
      },
      catmull: {
        name: "Edwin Catmull",
        born: 1945,
        died: null,
        flag: "🇺🇸",
        nationality: "American",
        discovery: "Catmull-Rom Splines & Subdivision",
        story: "Co-founder of Pixar! Created smooth curve algorithms while dreaming of making the first computer-animated movie. His math makes characters move smoothly and naturally.",
        kidFact: "He won an Oscar for his technology! Every Pixar movie (Toy Story, Finding Nemo, The Incredibles) uses his math to make characters move smoothly."
      },
      bezier: {
        name: "Pierre Bézier",
        born: 1910,
        died: 1999,
        flag: "🇫🇷",
        nationality: "French",
        discovery: "Bézier Curves",
        story: "Renault car designer who invented curves you can control with just a few points. Used in fonts, animations, car design, and every vector graphic you see!",
        kidFact: "Every letter you're reading right now uses Bézier curves! Computer fonts are made entirely of his curves. Even emojis! 😊"
      },
      perlin: {
        name: "Ken Perlin",
        born: 1951,
        died: null,
        flag: "🎮",
        nationality: "American",
        discovery: "Perlin Noise",
        story: "NYU professor who created natural-looking randomness for the movie TRON (1982). Won an Oscar for making computer graphics look organic instead of artificial!",
        kidFact: "Minecraft's entire world generation uses Perlin noise! Every mountain, cave, and biome is created with his algorithm. Without it, Minecraft wouldn't exist!"
      },
      quaternion: {
        name: "William Hamilton",
        born: 1805,
        died: 1865,
        flag: "🇮🇪",
        nationality: "Irish",
        discovery: "Quaternions",
        story: "Had a 'eureka moment' while walking across Brougham Bridge in Dublin. He was so excited he carved the formula (i²=j²=k²=ijk=-1) into the bridge stone with his knife!",
        kidFact: "Every 3D video game character rotation uses quaternions! They prevent 'gimbal lock' - a glitch that made old games spin weirdly. Your character wouldn't turn smoothly without them!"
      },
      lsystem: {
        name: "Aristid Lindenmayer",
        born: 1925,
        died: 1989,
        flag: "🇭🇺",
        nationality: "Hungarian",
        discovery: "L-Systems (Lindenmayer Systems)",
        story: "Biologist and botanist who created a simple alphabet system to model how plants grow. Simple rules like 'A becomes AB, B becomes A' create complex fractal patterns that look like real plants!",
        kidFact: "Video game trees and plants are grown with L-Systems! One simple rule repeated over and over can create an entire realistic forest. It's like growing a digital plant from a seed!"
      },
      voronoi: {
        name: "Georgy Voronoi",
        born: 1868,
        died: 1908,
        flag: "🇺🇦",
        nationality: "Ukrainian",
        discovery: "Voronoi Diagrams",
        story: "Mathematician who figured out how to divide space based on nearest neighbors. Imagine drawing territories around each point where everything inside is closer to that point than any other!",
        kidFact: "Giraffe spots follow Voronoi patterns! Nature uses this math for animal patterns, cell structures, and crystal growth. Your body's cells organize using Voronoi math!"
      },
      phong: {
        name: "Bui Tuong Phong",
        born: 1942,
        died: 1975,
        flag: "🇻🇳",
        nationality: "Vietnamese",
        discovery: "Phong Shading",
        story: "Created the lighting model that made 3D objects look shiny and realistic. His PhD thesis at University of Utah changed computer graphics forever. Tragically died of leukemia at age 32, but his legacy lives in every 3D game.",
        kidFact: "Every shiny surface in 3D games uses Phong shading! He made plastic, metal, and glass look real on computers. When you see light reflecting off a character's armor - that's his math!"
      },
      delaunay: {
        name: "Boris Delaunay",
        born: 1890,
        died: 1980,
        flag: "🇷🇺",
        nationality: "Russian",
        discovery: "Delaunay Triangulation",
        story: "Russian mathematician who figured out the optimal way to connect dots with triangles. His method creates the 'fattest' triangles possible, avoiding skinny ones that cause problems in 3D graphics.",
        kidFact: "3D game terrain is built with Delaunay triangles! Mountains, valleys, and landscapes are made by connecting height points with his optimal triangles. Every open-world game uses this!"
      },
      subdivision: {
        name: "Jim Clark & Edwin Catmull",
        born: 1944,
        died: null,
        flag: "💎",
        nationality: "American",
        discovery: "Subdivision Surfaces",
        story: "Jim Clark founded Silicon Graphics (the company that made movie CGI possible) and Netscape (early web browser). With Catmull, they figured out how to make blocky shapes smooth by subdividing faces repeatedly.",
        kidFact: "Every smooth 3D character starts blocky! Artists model a simple cube-like shape, then subdivision turns it into a smooth character. It's like magic - a cube becomes a smooth head!"
      }
    };

    function toggleLearnMode(btn) {
      learnModeActive = !learnModeActive;
      const info = document.getElementById('learnModeInfo');
      
      if (learnModeActive) {
        btn.innerHTML = '<span class="tool-icon">🎓</span><span>Learn Mode ON</span>';
        btn.style.background = 'rgba(0, 255, 136, 0.3)';
        btn.style.borderColor = '#00ff88';
        info.style.display = 'block';
        
        // Show initial method story
        showMathematicianStory(currentMethod);
        
        console.log(`
📚 ============================================
   LEARN MODE ACTIVATED!
   
   Now when you select Mathematical Methods,
   you'll see the mathematician's story, their
   discovery, and how it powers your creations!
   
   Click any method below to learn! 🏆
============================================
        `);
      } else {
        btn.innerHTML = '<span class="tool-icon">👨‍🏫</span><span>Enable Story Mode</span>';
        btn.style.background = 'rgba(0, 255, 136, 0.1)';
        btn.style.borderColor = 'rgba(0, 255, 136, 0.3)';
        info.style.display = 'none';
        document.getElementById('mathematicianStory').style.display = 'none';
      }
    }

    function selectMethod(method, btn) {
      currentMethod = method;
      
      // Update active button
      btn.parentElement.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Show story if Learn Mode is active
      if (learnModeActive) {
        showMathematicianStory(method);
      }
      
      // Log to console
      const mathematician = MATHEMATICIANS[method];
      console.log(`
🏆 ============================================
   METHOD SELECTED: ${mathematician.discovery}
   Mathematician: ${mathematician.name} (${mathematician.born}-${mathematician.died || 'Present'})
   ${mathematician.flag} ${mathematician.nationality}
   
   📖 Story: ${mathematician.story}
   
   💡 Kid Fact: ${mathematician.kidFact}
============================================
      `);
    }

    function showMathematicianStory(method) {
      const mathematician = MATHEMATICIANS[method];
      const panel = document.getElementById('mathematicianStory');
      
      // Update story content
      document.getElementById('storyTitle').textContent = `🏆 ${mathematician.discovery}`;
      document.getElementById('storyFlag').textContent = mathematician.flag;
      document.getElementById('storyName').textContent = mathematician.name;
      document.getElementById('storyDates').textContent = `${mathematician.born}-${mathematician.died || 'Present'} • ${mathematician.nationality}`;
      document.getElementById('storyDiscovery').textContent = `Discovery: ${mathematician.discovery}`;
      document.getElementById('storyText').textContent = mathematician.story;
      document.getElementById('storyKidFact').textContent = mathematician.kidFact;
      
      // Show panel with smooth animation
      panel.style.display = 'block';
    }

    // Start
    window.addEventListener('load', init);
  </script>
</body>
</html>
