<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Object Browser - PixelProdigy AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 16px;
        }

        .filter-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .object-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .object-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .canvas-container {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            position: relative;
        }

        .object-canvas {
            width: 100%;
            height: 100%;
        }

        .object-info {
            padding: 15px;
        }

        .object-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .object-details {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .tier-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .tier-legendary { background: #ffd700; color: #333; }
        .tier-epic { background: #9b59b6; color: white; }
        .tier-rare { background: #3498db; color: white; }
        .tier-common { background: #95a5a6; color: white; }

        .compression-badge {
            background: #2ecc71;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }

        .page-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            color: #667eea;
            transition: all 0.2s;
        }

        .page-btn:hover {
            background: #667eea;
            color: white;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5em;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #666;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-canvas {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .vls-code {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¨ 3D Object Browser</h1>
            <p>Explore 47,000 procedurally generated objects with VLS compression</p>
            <div class="stats">
                <div class="stat-item" id="total-objects">Loading...</div>
                <div class="stat-item" id="avg-compression">Loading...</div>
                <div class="stat-item" id="current-page-info">Page 1</div>
            </div>
        </header>

        <div class="controls">
            <input type="text" class="search-box" id="search-box" placeholder="Search objects...">
            <button class="filter-btn active" data-category="all">All</button>
            <button class="filter-btn" data-category="furniture">Furniture</button>
            <button class="filter-btn" data-category="vehicles">Vehicles</button>
            <button class="filter-btn" data-category="nature">Nature</button>
            <button class="filter-btn" data-category="tools">Tools</button>
            <button class="filter-btn" data-category="architecture">Architecture</button>
        </div>

        <div id="loading" class="loading">Loading objects...</div>

        <div class="grid" id="object-grid"></div>

        <div class="pagination" id="pagination"></div>
    </div>

    <!-- Modal for detailed view -->
    <div class="modal" id="object-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <canvas class="modal-canvas" id="modal-canvas"></canvas>
            <h2 id="modal-object-name"></h2>
            <div class="object-details">
                <span id="modal-tier"></span>
                <span id="modal-compression"></span>
            </div>
            <div class="vls-code">
                <strong>VLS Code:</strong>
                <pre id="modal-vls-code"></pre>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'http://localhost:3000/api';
        
        // State
        let currentPage = 1;
        let currentCategory = 'all';
        let totalPages = 1;
        let scenes = {};
        let modalScene = null;

        // Initialize
        async function init() {
            await loadStats();
            await loadObjects(currentPage, currentCategory);
            setupEventListeners();
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const stats = await response.json();
                
                const totalObjects = stats.totalObjects[0]?.count || 0;
                const avgCompression = stats.avgCompression[0]?.avg || 0;
                
                document.getElementById('total-objects').textContent = 
                    `ðŸ“¦ ${totalObjects.toLocaleString()} Objects`;
                document.getElementById('avg-compression').textContent = 
                    `ðŸ—œï¸ ${avgCompression.toFixed(1)}x Compression`;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load objects
        async function loadObjects(page = 1, category = 'all') {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('object-grid');
            
            loading.style.display = 'block';
            grid.innerHTML = '';
            
            try {
                let url = `${API_BASE}/objects?page=${page}&limit=24`;
                if (category !== 'all') {
                    url += `&category=${category}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                currentPage = page;
                totalPages = data.pagination.totalPages;
                
                document.getElementById('current-page-info').textContent = 
                    `Page ${page} of ${totalPages}`;
                
                loading.style.display = 'none';
                
                // Render objects
                data.objects.forEach(obj => {
                    renderObjectCard(obj);
                });
                
                // Update pagination
                updatePagination();
                
            } catch (error) {
                console.error('Error loading objects:', error);
                loading.textContent = 'Error loading objects. Is the server running?';
            }
        }

        // Render object card with 3D preview
        function renderObjectCard(obj) {
            const grid = document.getElementById('object-grid');
            
            const card = document.createElement('div');
            card.className = 'object-card';
            card.onclick = () => openModal(obj);
            
            const canvasId = `canvas-${obj.id}`;
            const aiContext = determineAIPersonality(obj.name);
            
            card.innerHTML = `
                <div class="canvas-container">
                    <canvas class="object-canvas" id="${canvasId}"></canvas>
                </div>
                <div class="object-info">
                    <div class="object-name">${obj.name}</div>
                    <div style="font-size: 0.8em; color: #888; margin: 5px 0;">
                        ðŸ¤– AI: ${aiContext.name}
                    </div>
                    <div class="object-details">
                        <span class="tier-badge tier-${obj.tier}">${obj.tier}</span>
                        <span class="compression-badge">${obj.compression_ratio.toFixed(0)}x</span>
                    </div>
                </div>
            `;
            
            grid.appendChild(card);
            
            // Initialize 3D scene for this card
            setTimeout(() => initCardScene(canvasId, obj), 100);
        }

        // Initialize 3D scene for card
        function initCardScene(canvasId, obj) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(45, canvas.width / canvas.height, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setClearColor(0x000000, 0);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // Create geometry with AI personality influence
            const aiContext = determineAIPersonality(obj.name);
            const geometry = createGeometryFromVLS(obj.vls_code, obj.name);
            const material = new THREE.MeshPhongMaterial({ 
                color: aiContext.color,
                shininess: aiContext.style === 'luxurious' ? 80 : 
                          aiContext.style === 'precise' ? 60 : 30,
                flatShading: aiContext.style === 'precise'
            });
            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
            
            camera.position.z = 3;
            
            // Animation
            function animate() {
                requestAnimationFrame(animate);
                mesh.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
            
            scenes[canvasId] = { scene, camera, renderer, mesh };
        }

        // Create geometry from VLS code with AI personality context
        function createGeometryFromVLS(vls_code, obj_name = '') {
            // Determine AI personality and shape based on object name and VLS
            const aiContext = determineAIPersonality(obj_name);
            const baseShape = determineBaseShape(vls_code, obj_name);
            
            // Generate geometry with personality influence
            let geometry;
            const detail = aiContext.precision * 32; // Higher precision = more segments
            
            switch(baseShape) {
                case 'sphere':
                    geometry = new THREE.SphereGeometry(1, detail, detail);
                    break;
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(0.5, 0.5, 2, detail);
                    break;
                case 'organic':
                    geometry = new THREE.IcosahedronGeometry(1, Math.floor(aiContext.precision * 2));
                    break;
                case 'torus':
                    geometry = new THREE.TorusGeometry(0.8, 0.3, 16, Math.floor(detail));
                    break;
                default:
                    geometry = new THREE.BoxGeometry(1, 1, 1, 
                        Math.floor(aiContext.precision * 4), 
                        Math.floor(aiContext.precision * 4), 
                        Math.floor(aiContext.precision * 4));
            }
            
            // Apply AI personality transformations to vertices
            applyAIPersonalityStyling(geometry, aiContext);
            
            return geometry;
        }
        
        // Determine AI personality from object characteristics
        function determineAIPersonality(name) {
            const nameLower = name.toLowerCase();
            
            // Map object types to AI personalities
            if (nameLower.includes('furniture') || nameLower.includes('chair') || nameLower.includes('table')) {
                return { id: 30, name: 'Interior Designer', style: 'luxurious', precision: 0.8, color: 0x8B4513 };
            } else if (nameLower.includes('tree') || nameLower.includes('plant') || nameLower.includes('rock')) {
                return { id: 14, name: 'Organic Naturalist', style: 'organic', precision: 0.6, color: 0x228B22 };
            } else if (nameLower.includes('car') || nameLower.includes('vehicle') || nameLower.includes('aircraft')) {
                return { id: 20, name: 'Vehicle Designer', style: 'aerodynamic', precision: 0.9, color: 0xFF4500 };
            } else if (nameLower.includes('tool') || nameLower.includes('drill') || nameLower.includes('saw')) {
                return { id: 33, name: 'Industrial Designer', style: 'precise', precision: 1.0, color: 0x708090 };
            } else if (nameLower.includes('building') || nameLower.includes('house') || nameLower.includes('architecture')) {
                return { id: 25, name: 'Residential Architect', style: 'structural', precision: 0.9, color: 0x4169E1 };
            } else {
                return { id: 1, name: 'Visionary Artist', style: 'creative', precision: 0.5, color: 0x9370DB };
            }
        }
        
        // Determine base shape from VLS and object name
        function determineBaseShape(vls_code, name) {
            const nameLower = name.toLowerCase();
            const vls = vls_code.toLowerCase();
            
            if (vls.includes('sphere') || nameLower.includes('ball') || nameLower.includes('orb')) {
                return 'sphere';
            } else if (vls.includes('cylinder') || nameLower.includes('pipe') || nameLower.includes('barrel')) {
                return 'cylinder';
            } else if (vls.includes('organic') || nameLower.includes('tree') || nameLower.includes('plant')) {
                return 'organic';
            } else if (nameLower.includes('ring') || nameLower.includes('tire')) {
                return 'torus';
            } else {
                return 'box';
            }
        }
        
        // Apply AI personality styling to geometry vertices
        function applyAIPersonalityStyling(geometry, aiContext) {
            const vertices = geometry.attributes.position;
            
            for (let i = 0; i < vertices.count; i++) {
                let x = vertices.getX(i);
                let y = vertices.getY(i);
                let z = vertices.getZ(i);
                
                switch(aiContext.style) {
                    case 'luxurious':
                        // Smooth, rounded edges
                        x *= 1.1;
                        y *= 1.1;
                        z *= 1.1;
                        break;
                    case 'organic':
                        // Natural variation
                        x += Math.sin(y * 3) * 0.05;
                        z += Math.cos(x * 3) * 0.05;
                        break;
                    case 'aerodynamic':
                        // Streamlined
                        z *= 1.5;
                        break;
                    case 'precise':
                        // Sharp, exact (no modification needed)
                        break;
                    case 'creative':
                        // Artistic variation
                        const scale = 1.0 + Math.sin(x + y + z) * 0.1;
                        x *= scale;
                        y *= scale;
                        z *= scale;
                        break;
                }
                
                vertices.setXYZ(i, x, y, z);
            }
            
            vertices.needsUpdate = true;
            geometry.computeVertexNormals();
        }

        // Get color based on object name
        function getColorFromName(name) {
            const colors = {
                furniture: 0x8B4513,
                vehicle: 0xFF0000,
                nature: 0x00FF00,
                tool: 0x808080,
                architecture: 0x4169E1,
                food: 0xFFA500
            };
            
            for (const [key, color] of Object.entries(colors)) {
                if (name.toLowerCase().includes(key)) {
                    return color;
                }
            }
            
            return 0x667eea;
        }

        // Open modal with detailed view
        function openModal(obj) {
            const modal = document.getElementById('object-modal');
            modal.classList.add('active');
            
            const aiContext = determineAIPersonality(obj.name);
            
            document.getElementById('modal-object-name').textContent = obj.name;
            document.getElementById('modal-tier').innerHTML = 
                `<span class="tier-badge tier-${obj.tier}">${obj.tier}</span>`;
            document.getElementById('modal-compression').innerHTML = 
                `<span class="compression-badge">${obj.compression_ratio.toFixed(0)}x Compression</span>`;
            
            // Show GENE code with AI personality context
            const geneCode = `OBJECT: ${obj.name}
AI_PERSONALITY: ${aiContext.name} (#${aiContext.id})
STYLE: ${aiContext.style}
PRECISION: ${(aiContext.precision * 100).toFixed(0)}%

${obj.vls_code}

VERTEX_COUNT: ${calculateVertexCount(obj.vls_code, aiContext)}
RENDERING_QUALITY: ${aiContext.precision > 0.8 ? 'High' : aiContext.precision > 0.5 ? 'Medium' : 'Creative'}
COLOR_SCHEME: ${getColorName(aiContext.color)}`;
            
            document.getElementById('modal-vls-code').textContent = geneCode;
            
            // Initialize modal 3D scene
            setTimeout(() => initModalScene(obj), 100);
        }
        
        function calculateVertexCount(vls_code, aiContext) {
            // Estimate vertex count based on shape and precision
            const baseShape = determineBaseShape(vls_code, '');
            const detail = aiContext.precision * 32;
            
            switch(baseShape) {
                case 'sphere':
                    return Math.floor(detail * detail);
                case 'cylinder':
                    return Math.floor(detail * 2);
                case 'box':
                    return 8 + Math.floor(aiContext.precision * 48);
                default:
                    return Math.floor(detail);
            }
        }
        
        function getColorName(color) {
            const colorNames = {
                0x8B4513: 'Warm Brown (Furniture)',
                0x228B22: 'Forest Green (Nature)',
                0xFF4500: 'Racing Red (Vehicles)',
                0x708090: 'Industrial Gray (Tools)',
                0x4169E1: 'Royal Blue (Architecture)',
                0x9370DB: 'Creative Purple (Artistic)'
            };
            return colorNames[color] || `#${color.toString(16).padStart(6, '0')}`;
        }

        // Initialize modal 3D scene
        function initModalScene(obj) {
            const canvas = document.getElementById('modal-canvas');
            
            if (modalScene) {
                modalScene.renderer.dispose();
            }
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(45, canvas.width / canvas.height, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setClearColor(0xf5f7fa);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // Create geometry with AI personality
            const aiContext = determineAIPersonality(obj.name);
            const geometry = createGeometryFromVLS(obj.vls_code, obj.name);
            const material = new THREE.MeshPhongMaterial({ 
                color: aiContext.color,
                shininess: aiContext.style === 'luxurious' ? 80 : 
                          aiContext.style === 'precise' ? 60 : 30,
                flatShading: aiContext.style === 'precise'
            });
            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
            
            camera.position.z = 5;
            
            // Animation
            function animate() {
                if (document.getElementById('object-modal').classList.contains('active')) {
                    requestAnimationFrame(animate);
                    mesh.rotation.y += 0.01;
                    mesh.rotation.x += 0.005;
                    renderer.render(scene, camera);
                }
            }
            animate();
            
            modalScene = { scene, camera, renderer, mesh };
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('object-modal');
            modal.classList.remove('active');
        }

        // Update pagination
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'page-btn';
                prevBtn.textContent = 'â† Previous';
                prevBtn.onclick = () => loadObjects(currentPage - 1, currentCategory);
                pagination.appendChild(prevBtn);
            }
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i;
                pageBtn.onclick = () => loadObjects(i, currentCategory);
                pagination.appendChild(pageBtn);
            }
            
            // Next button
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'page-btn';
                nextBtn.textContent = 'Next â†’';
                nextBtn.onclick = () => loadObjects(currentPage + 1, currentCategory);
                pagination.appendChild(nextBtn);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Category filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    loadObjects(1, currentCategory);
                });
            });
            
            // Search box
            let searchTimeout;
            document.getElementById('search-box').addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = e.target.value;
                    if (searchTerm.length > 2) {
                        searchObjects(searchTerm);
                    } else if (searchTerm.length === 0) {
                        loadObjects(1, currentCategory);
                    }
                }, 500);
            });
            
            // Close modal on outside click
            document.getElementById('object-modal').addEventListener('click', (e) => {
                if (e.target.id === 'object-modal') {
                    closeModal();
                }
            });
        }

        // Search objects
        async function searchObjects(term) {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('object-grid');
            
            loading.style.display = 'block';
            grid.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/search?q=${term}&limit=24`);
                const objects = await response.json();
                
                loading.style.display = 'none';
                
                objects.forEach(obj => {
                    renderObjectCard(obj);
                });
                
                document.getElementById('pagination').innerHTML = '';
                
            } catch (error) {
                console.error('Error searching objects:', error);
            }
        }

        // Start the app
        init();
    </script>
</body>
</html>
