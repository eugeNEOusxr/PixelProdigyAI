<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BroWiseXR - The Wise Browser for XR</title>
  <link rel="icon" href="browisexr_favicon.svg">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a0a0a;
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }

    /* BROWISEXR HEADER */
    #browisexrHeader {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
    }

    .browisexr-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      margin-right: 40px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      animation: xrPulse 3s ease-in-out infinite;
    }

    @keyframes xrPulse {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(90deg); }
      50% { transform: scale(1) rotate(180deg); }
      75% { transform: scale(1.1) rotate(270deg); }
    }

    .search-bar {
      flex: 1;
      max-width: 600px;
      position: relative;
    }

    .search-bar input {
      width: 100%;
      padding: 12px 50px 12px 20px;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.3s;
    }

    .search-bar input:focus {
      background: rgba(255, 255, 255, 0.25);
      border-color: #fff;
    }

    .search-bar input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      pointer-events: none;
    }

    .browiser-stats {
      display: flex;
      gap: 20px;
      margin-left: 20px;
    }

    .stat-box {
      text-align: center;
      padding: 5px 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 700;
    }

    .stat-label {
      font-size: 10px;
      opacity: 0.8;
      text-transform: uppercase;
    }

    /* SIDEBAR - Categories */
    #sidebar {
      position: fixed;
      left: 0;
      top: 70px;
      width: 260px;
      height: calc(100vh - 70px);
      background: #1a1a1a;
      border-right: 2px solid #333;
      overflow-y: auto;
      padding: 20px;
    }

    .category-section {
      margin-bottom: 24px;
    }

    .category-title {
      font-size: 12px;
      font-weight: 600;
      color: #667eea;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .category-item {
      padding: 12px 15px;
      background: rgba(102, 126, 234, 0.05);
      border-left: 3px solid transparent;
      border-radius: 6px;
      margin-bottom: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .category-item:hover {
      background: rgba(102, 126, 234, 0.15);
      border-left-color: #667eea;
      transform: translateX(4px);
    }

    .category-item.active {
      background: rgba(102, 126, 234, 0.2);
      border-left-color: #00ff88;
    }

    .category-count {
      font-size: 11px;
      background: rgba(102, 126, 234, 0.3);
      padding: 2px 8px;
      border-radius: 12px;
    }

    /* MAIN VIEWPORT - 3D Preview */
    #viewport {
      position: fixed;
      left: 260px;
      top: 70px;
      right: 320px;
      height: calc(100vh - 70px - 150px);
      background: #0f0f0f;
      border: 2px solid #333;
    }

    #canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .viewport-overlay {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      padding: 12px 20px;
      border-radius: 8px;
      border: 1px solid #667eea;
      backdrop-filter: blur(10px);
    }

    .object-name {
      font-size: 18px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 4px;
    }

    .object-meta {
      font-size: 11px;
      color: #888;
    }

    /* OBJECT GRID - Bottom Browser */
    #objectGrid {
      position: fixed;
      left: 260px;
      right: 320px;
      bottom: 0;
      height: 150px;
      background: #1a1a1a;
      border-top: 2px solid #333;
      overflow-x: auto;
      overflow-y: hidden;
      display: flex;
      gap: 10px;
      padding: 10px;
    }

    .object-card {
      min-width: 130px;
      height: 130px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px;
      position: relative;
    }

    .object-card:hover {
      transform: translateY(-5px) scale(1.05);
      border-color: #667eea;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .object-card.selected {
      border-color: #00ff88;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
    }

    .object-icon {
      font-size: 40px;
      margin-bottom: 8px;
    }

    .object-title {
      font-size: 11px;
      text-align: center;
      font-weight: 600;
      color: #fff;
    }

    .object-vls {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #667eea;
      color: #fff;
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 700;
    }

    /* RIGHT PANEL - Object Details */
    #detailsPanel {
      position: fixed;
      right: 0;
      top: 70px;
      width: 320px;
      height: calc(100vh - 70px);
      background: #1a1a1a;
      border-left: 2px solid #333;
      overflow-y: auto;
      padding: 20px;
    }

    .detail-section {
      margin-bottom: 24px;
    }

    .detail-title {
      font-size: 14px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 12px;
    }

    .detail-info {
      background: rgba(102, 126, 234, 0.05);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .info-label {
      font-size: 11px;
      color: #888;
      margin-bottom: 4px;
    }

    .info-value {
      font-size: 13px;
      color: #fff;
      font-weight: 600;
    }

    .action-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 10px;
      transition: all 0.2s;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .action-btn.secondary {
      background: rgba(102, 126, 234, 0.2);
      border: 2px solid #667eea;
    }

    /* AI PERSONALITY BADGE */
    .personality-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(102, 126, 234, 0.1);
      padding: 12px;
      border-radius: 8px;
      border-left: 3px solid #667eea;
    }

    .personality-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .personality-info {
      flex: 1;
    }

    .personality-name {
      font-size: 13px;
      font-weight: 700;
      color: #fff;
    }

    .personality-style {
      font-size: 11px;
      color: #888;
    }

    /* LOADING STATE */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(102, 126, 234, 0.2);
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* SCROLLBAR STYLING */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }

    ::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #764ba2;
    }
  </style>
</head>
<body>
  <!-- BroWiseXR Header -->
  <div id="browisexrHeader">
    <div class="browisexr-logo">
      <div class="logo-icon">üéÆ</div>
      <div style="display: flex; flex-direction: column; line-height: 1.2;">
        <div style="font-size: 24px; font-weight: 700;">BRO<span style="color: #00ff88;">WISE</span>XR</div>
        <div style="font-size: 9px; opacity: 0.8; letter-spacing: 1px;">THE WISE BROWSER FOR XR</div>
      </div>
    </div>
    
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search 10,000 GENE objects... (be wiser)" oninput="searchObjects(this.value)">
      <span class="search-icon">üîç</span>
    </div>
    
    <div class="browiser-stats">
      <div class="stat-box">
        <div class="stat-value" id="totalObjects">10,020</div>
        <div class="stat-label">Objects</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="loadedCount">0</div>
        <div class="stat-label">Loaded</div>
      </div>
      <div class="stat-box">
        <div class="stat-value">144</div>
        <div class="stat-label">AI Artists</div>
      </div>
    </div>
  </div>

  <!-- Sidebar - Categories -->
  <div id="sidebar">
    <div class="category-section">
      <div class="category-title">üì¶ Categories</div>
      <div class="category-item active" onclick="filterCategory('all')">
        <span>All Objects</span>
        <span class="category-count">10,020</span>
      </div>
      <div class="category-item" onclick="filterCategory('furniture')">
        <span>ü™ë Furniture</span>
        <span class="category-count">1,000</span>
      </div>
      <div class="category-item" onclick="filterCategory('architecture')">
        <span>üèõÔ∏è Architecture</span>
        <span class="category-count">1,000</span>
      </div>
      <div class="category-item" onclick="filterCategory('vehicles')">
        <span>üöó Vehicles</span>
        <span class="category-count">800</span>
      </div>
      <div class="category-item" onclick="filterCategory('nature')">
        <span>üå≥ Nature</span>
        <span class="category-count">800</span>
      </div>
      <div class="category-item" onclick="filterCategory('characters')">
        <span>üßç Characters</span>
        <span class="category-count">800</span>
      </div>
      <div class="category-item" onclick="filterCategory('tools')">
        <span>üîß Tools</span>
        <span class="category-count">600</span>
      </div>
      <div class="category-item" onclick="filterCategory('food')">
        <span>üçî Food</span>
        <span class="category-count">600</span>
      </div>
      <div class="category-item" onclick="filterCategory('electronics')">
        <span>üì± Electronics</span>
        <span class="category-count">500</span>
      </div>
      <div class="category-item" onclick="filterCategory('weapons')">
        <span>‚öîÔ∏è Weapons</span>
        <span class="category-count">400</span>
      </div>
      <div class="category-item" onclick="filterCategory('clothing')">
        <span>üëî Clothing</span>
        <span class="category-count">400</span>
      </div>
      <div class="category-item" onclick="filterCategory('misc')">
        <span>üì¶ Miscellaneous</span>
        <span class="category-count">3,120</span>
      </div>
    </div>

    <div class="category-section">
      <div class="category-title">‚ö° Quality</div>
      <div class="category-item" onclick="filterVLS('VLS3')">
        <span>VLS 3 (720p)</span>
        <span class="category-count">10,020</span>
      </div>
    </div>
  </div>

  <!-- Main 3D Viewport -->
  <div id="viewport">
    <canvas id="canvas"></canvas>
    <div class="viewport-overlay">
      <div class="object-name" id="viewportObjectName">Select an object</div>
      <div class="object-meta" id="viewportObjectMeta">Browse from the gallery below</div>
    </div>
    <div class="loading" id="loadingState">
      <div class="spinner"></div>
      <div>Loading GENE objects...</div>
    </div>
  </div>

  <!-- Object Grid Browser -->
  <div id="objectGrid">
    <!-- Will be populated by JavaScript -->
  </div>

  <!-- Right Panel - Details -->
  <div id="detailsPanel">
    <div class="detail-section">
      <div class="detail-title">üìä Object Information</div>
      <div class="detail-info">
        <div class="info-label">Object Name</div>
        <div class="info-value" id="detailName">No object selected</div>
      </div>
      <div class="detail-info">
        <div class="info-label">Category</div>
        <div class="info-value" id="detailCategory">-</div>
      </div>
      <div class="detail-info">
        <div class="info-label">VLS Quality</div>
        <div class="info-value" id="detailVLS">-</div>
      </div>
      <div class="detail-info">
        <div class="info-label">Vertices</div>
        <div class="info-value" id="detailVertices">-</div>
      </div>
      <div class="detail-info">
        <div class="info-label">File Size</div>
        <div class="info-value" id="detailSize">-</div>
      </div>
    </div>

    <div class="detail-section">
      <div class="detail-title">ü§ñ Created By</div>
      <div class="personality-badge">
        <div class="personality-avatar" id="personalityAvatar">üé®</div>
        <div class="personality-info">
          <div class="personality-name" id="personalityName">AI Artist #1</div>
          <div class="personality-style" id="personalityStyle">Creative Visionary</div>
        </div>
      </div>
    </div>

    <div class="detail-section">
      <button class="action-btn" onclick="downloadObject()">‚¨áÔ∏è Download GENE</button>
      <button class="action-btn secondary" onclick="addToScene()">‚ûï Add to Scene</button>
      <button class="action-btn secondary" onclick="viewInWorkLink()">üîó Open in WorkLink</button>
    </div>

    <div class="detail-section">
      <div class="detail-title">üí° Quick Actions</div>
      <button class="action-btn secondary" onclick="randomObject()">üé≤ Random Object</button>
      <button class="action-btn secondary" onclick="viewSource()">üìÑ View GENE Source</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // =============================================
    // BROWISER - THE WISER GENE BROWSER
    // =============================================

    let scene, camera, renderer, controls;
    let currentObject = null;
    let geneObjects = [];
    let filteredObjects = [];
    let currentCategory = 'all';

    // =============================================
    // INITIALIZE THREE.JS
    // =============================================

    function initThreeJS() {
      const canvas = document.getElementById('canvas');
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0f0f0f);
      scene.fog = new THREE.Fog(0x0f0f0f, 10, 50);

      camera = new THREE.PerspectiveCamera(60, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
      camera.position.set(3, 3, 3);
      camera.lookAt(0, 0, 0);

      renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);
      renderer.shadowMap.enabled = true;

      // Lighting
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);

      const directional = new THREE.DirectionalLight(0xffffff, 0.8);
      directional.position.set(5, 10, 5);
      directional.castShadow = true;
      scene.add(directional);

      const point1 = new THREE.PointLight(0x667eea, 0.8, 50);
      point1.position.set(-5, 5, -5);
      scene.add(point1);

      const point2 = new THREE.PointLight(0x764ba2, 0.8, 50);
      point2.position.set(5, 5, 5);
      scene.add(point2);

      // Auto-rotate camera
      let angle = 0;
      setInterval(() => {
        angle += 0.005;
        camera.position.x = Math.cos(angle) * 5;
        camera.position.z = Math.sin(angle) * 5;
        camera.lookAt(0, 0, 0);
      }, 16);

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    // =============================================
    // GENE OBJECT LOADER
    // =============================================

    async function loadGENEObjects() {
      console.log('üß¨ Loading GENE objects from /generated_objects/...');
      
      // Simulate loading (since we can't actually list directory in browser)
      // In production, you'd have a manifest.json or API endpoint
      
      const categories = {
        furniture: 1000,
        architecture: 1000,
        vehicles: 800,
        nature: 800,
        characters: 800,
        tools: 600,
        food: 600,
        electronics: 500,
        weapons: 400,
        clothing: 400,
        misc: 3120
      };

      let objectId = 0;
      
      for (let [category, count] of Object.entries(categories)) {
        for (let i = 1; i <= count; i++) {
          objectId++;
          geneObjects.push({
            id: objectId,
            name: `${category}_${String(i).padStart(4, '0')}`,
            category: category,
            vls: 'VLS3',
            filename: `${category}_${String(i).padStart(4, '0')}.gene`,
            vertices: Math.floor(Math.random() * 5000) + 1000,
            fileSize: Math.floor(Math.random() * 50) + 10,
            aiPersonality: Math.floor(Math.random() * 144) + 1,
            icon: getCategoryIcon(category)
          });
        }
      }

      filteredObjects = [...geneObjects];
      
      console.log(`‚úÖ Loaded ${geneObjects.length} GENE objects!`);
      document.getElementById('loadedCount').textContent = geneObjects.length.toLocaleString();
      
      renderObjectGrid();
      hideLoading();
    }

    function getCategoryIcon(category) {
      const icons = {
        furniture: 'ü™ë',
        architecture: 'üèõÔ∏è',
        vehicles: 'üöó',
        nature: 'üå≥',
        characters: 'üßç',
        tools: 'üîß',
        food: 'üçî',
        electronics: 'üì±',
        weapons: '‚öîÔ∏è',
        clothing: 'üëî',
        misc: 'üì¶'
      };
      return icons[category] || 'üì¶';
    }

    // =============================================
    // RENDER OBJECT GRID
    // =============================================

    function renderObjectGrid() {
      const grid = document.getElementById('objectGrid');
      grid.innerHTML = '';

      // Show first 100 objects (pagination can be added later)
      const objectsToShow = filteredObjects.slice(0, 100);

      objectsToShow.forEach(obj => {
        const card = document.createElement('div');
        card.className = 'object-card';
        card.onclick = () => selectObject(obj);
        
        card.innerHTML = `
          <div class="object-vls">${obj.vls}</div>
          <div class="object-icon">${obj.icon}</div>
          <div class="object-title">${obj.name}</div>
        `;
        
        grid.appendChild(card);
      });
    }

    // =============================================
    // SELECT OBJECT
    // =============================================

    function selectObject(obj) {
      currentObject = obj;
      
      // Highlight selected card
      document.querySelectorAll('.object-card').forEach(card => {
        card.classList.remove('selected');
      });
      event.target.closest('.object-card').classList.add('selected');
      
      // Update viewport overlay
      document.getElementById('viewportObjectName').textContent = obj.name;
      document.getElementById('viewportObjectMeta').textContent = `${obj.category} ‚Ä¢ ${obj.vls} ‚Ä¢ AI #${obj.aiPersonality}`;
      
      // Update details panel
      document.getElementById('detailName').textContent = obj.name;
      document.getElementById('detailCategory').textContent = obj.category.toUpperCase();
      document.getElementById('detailVLS').textContent = `${obj.vls} (720p Quality)`;
      document.getElementById('detailVertices').textContent = obj.vertices.toLocaleString();
      document.getElementById('detailSize').textContent = `${obj.fileSize} KB`;
      
      // Update AI personality
      document.getElementById('personalityAvatar').textContent = obj.icon;
      document.getElementById('personalityName').textContent = `AI Artist #${obj.aiPersonality}`;
      document.getElementById('personalityStyle').textContent = getPersonalityStyle(obj.aiPersonality);
      
      // Load and render 3D preview
      render3DPreview(obj);
    }

    function getPersonalityStyle(id) {
      const styles = ['Creative Visionary', 'Precise Engineer', 'Organic Naturalist', 'Futuristic Designer', 'Classical Sculptor'];
      return styles[id % styles.length];
    }

    // =============================================
    // 3D PREVIEW RENDERING
    // =============================================

    function render3DPreview(obj) {
      // Clear existing objects
      while(scene.children.length > 0) { 
        const object = scene.children[0];
        if (object.geometry) object.geometry.dispose();
        if (object.material) object.material.dispose();
        scene.remove(object);
      }

      // Re-add lights
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);

      const directional = new THREE.DirectionalLight(0xffffff, 0.8);
      directional.position.set(5, 10, 5);
      scene.add(directional);

      const point1 = new THREE.PointLight(0x667eea, 0.8, 50);
      point1.position.set(-5, 5, -5);
      scene.add(point1);

      const point2 = new THREE.PointLight(0x764ba2, 0.8, 50);
      point2.position.set(5, 5, 5);
      scene.add(point2);

      // Create procedural geometry based on category
      let geometry;
      
      switch(obj.category) {
        case 'furniture':
          geometry = new THREE.BoxGeometry(1, 1.5, 1);
          break;
        case 'architecture':
          geometry = new THREE.BoxGeometry(2, 3, 2);
          break;
        case 'vehicles':
          geometry = new THREE.CylinderGeometry(0.5, 0.8, 2, 16);
          break;
        case 'nature':
          geometry = new THREE.ConeGeometry(1, 2, 8);
          break;
        case 'characters':
          geometry = new THREE.CapsuleGeometry(0.5, 2, 8, 16);
          break;
        default:
          geometry = new THREE.IcosahedronGeometry(1, 1);
      }

      const material = new THREE.MeshStandardMaterial({
        color: getColorForCategory(obj.category),
        roughness: 0.6,
        metalness: 0.4,
        flatShading: true
      });

      const mesh = new THREE.Mesh(geometry, material);
      mesh.castShadow = true;
      mesh.receiveShadow = true;
      scene.add(mesh);

      // Add wireframe overlay
      const wireframe = new THREE.LineSegments(
        new THREE.EdgesGeometry(geometry),
        new THREE.LineBasicMaterial({ color: 0x667eea, linewidth: 2 })
      );
      mesh.add(wireframe);
    }

    function getColorForCategory(category) {
      const colors = {
        furniture: 0x8B4513,
        architecture: 0x708090,
        vehicles: 0xFF4500,
        nature: 0x228B22,
        characters: 0xFFD700,
        tools: 0x4682B4,
        food: 0xFF6347,
        electronics: 0x00CED1,
        weapons: 0xDC143C,
        clothing: 0x9370DB,
        misc: 0x667eea
      };
      return colors[category] || 0x667eea;
    }

    // =============================================
    // FILTERING & SEARCH
    // =============================================

    function filterCategory(category) {
      currentCategory = category;
      
      // Update UI
      document.querySelectorAll('.category-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Filter objects
      if (category === 'all') {
        filteredObjects = [...geneObjects];
      } else {
        filteredObjects = geneObjects.filter(obj => obj.category === category);
      }
      
      renderObjectGrid();
    }

    function searchObjects(query) {
      if (!query) {
        filteredObjects = [...geneObjects];
      } else {
        filteredObjects = geneObjects.filter(obj => 
          obj.name.toLowerCase().includes(query.toLowerCase()) ||
          obj.category.toLowerCase().includes(query.toLowerCase())
        );
      }
      
      renderObjectGrid();
    }

    function filterVLS(vls) {
      filteredObjects = geneObjects.filter(obj => obj.vls === vls);
      renderObjectGrid();
    }

    // =============================================
    // ACTIONS
    // =============================================

    function downloadObject() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      alert(`‚¨áÔ∏è Downloading: ${currentObject.filename}\n\nFile path: /generated_objects/${currentObject.category}/${currentObject.filename}`);
      
      // TODO: Implement actual download
      // window.location.href = `/generated_objects/${currentObject.category}/${currentObject.filename}`;
    }

    function addToScene() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      alert(`‚ûï Added ${currentObject.name} to scene!\n\nThis will be implemented when integrated with WorkLink.`);
    }

    function viewInWorkLink() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      // Open in WorkLink
      window.open(`/worklink_adaptive.html?object=${currentObject.filename}`, '_blank');
    }

    function randomObject() {
      const randomObj = filteredObjects[Math.floor(Math.random() * filteredObjects.length)];
      
      // Find and click the card
      const cards = document.querySelectorAll('.object-card');
      const index = filteredObjects.indexOf(randomObj);
      if (cards[index]) {
        cards[index].click();
        cards[index].scrollIntoView({ behavior: 'smooth', inline: 'center' });
      }
    }

    function viewSource() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      // Generate example GENE source
      const geneSource = `VLS3:720p
AI_PERSONALITY:${currentObject.aiPersonality}
CATEGORY:${currentObject.category}
VERTICES:${currentObject.vertices}

// Vertex data (compressed)
v 0.000 0.000 0.000
v 1.000 0.000 0.000
v 1.000 1.000 0.000
...

// Face data
f 1 2 3
f 2 3 4
...

// 2,800√ó compression achieved!
`;
      
      alert(`üìÑ GENE Source: ${currentObject.filename}\n\n${geneSource}`);
    }

    function hideLoading() {
      document.getElementById('loadingState').style.display = 'none';
    }

    // =============================================
    // INITIALIZATION
    // =============================================

    window.addEventListener('load', () => {
      initThreeJS();
      loadGENEObjects();
    });

    // Responsive canvas
    window.addEventListener('resize', () => {
      const canvas = document.getElementById('canvas');
      camera.aspect = canvas.clientWidth / canvas.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'r' || e.key === 'R') randomObject();
      if (e.key === 'd' || e.key === 'D') downloadObject();
      if (e.key === ' ') {
        e.preventDefault();
        addToScene();
      }
    });
  </script>
</body>
</html>
