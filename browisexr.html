<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BroWiseXR - The Wise Browser for XR</title>
  <link rel="icon" href="browisexr_favicon.svg">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a0a0a;
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }

    /* BROWISEXR HEADER */
    #browisexrHeader {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
    }

    .browisexr-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      margin-right: 40px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      animation: xrPulse 3s ease-in-out infinite;
    }

    @keyframes xrPulse {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(90deg); }
      50% { transform: scale(1) rotate(180deg); }
      75% { transform: scale(1.1) rotate(270deg); }
    }

    .search-bar {
      flex: 1;
      max-width: 600px;
      position: relative;
    }

    .search-bar input {
      width: 100%;
      padding: 12px 50px 12px 20px;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.3s;
    }

    .search-bar input:focus {
      background: rgba(255, 255, 255, 0.25);
      border-color: #fff;
    }

    .search-bar input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      pointer-events: none;
    }

    /* METHOD SELECTOR */
    .method-selector {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: 20px;
    }

    .method-selector label {
      font-size: 12px;
      font-weight: 600;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .method-selector select {
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      outline: none;
      transition: all 0.3s;
    }

    .method-selector select:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: #00ff88;
    }

    .method-selector select option {
      background: #1a1a1a;
      color: #fff;
    }

    .tribute-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 8px;
      background: rgba(0, 255, 136, 0.2);
      border: 1px solid rgba(0, 255, 136, 0.4);
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      color: #00ff88;
      margin-left: 8px;
      animation: tributePulse 2s ease-in-out infinite;
    }

    @keyframes tributePulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; box-shadow: 0 0 10px rgba(0, 255, 136, 0.5); }
    }

    .browiser-stats {
      display: flex;
      gap: 20px;
      margin-left: 20px;
    }

    .stat-box {
      text-align: center;
      padding: 5px 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 700;
    }

    .stat-label {
      font-size: 10px;
      opacity: 0.8;
      text-transform: uppercase;
    }

    /* SIDEBAR - Categories */
    #sidebar {
      position: fixed;
      left: 0;
      top: 70px;
      width: 260px;
      height: calc(100vh - 70px);
      background: #1a1a1a;
      border-right: 2px solid #333;
      overflow-y: auto;
      padding: 20px;
    }

    .category-section {
      margin-bottom: 24px;
    }

    .category-title {
      font-size: 12px;
      font-weight: 600;
      color: #667eea;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .category-item {
      padding: 12px 15px;
      background: rgba(102, 126, 234, 0.05);
      border-left: 3px solid transparent;
      border-radius: 6px;
      margin-bottom: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .category-item:hover {
      background: rgba(102, 126, 234, 0.15);
      border-left-color: #667eea;
      transform: translateX(4px);
    }

    .category-item.active {
      background: rgba(102, 126, 234, 0.2);
      border-left-color: #00ff88;
    }

    .category-count {
      font-size: 11px;
      background: rgba(102, 126, 234, 0.3);
      padding: 2px 8px;
      border-radius: 12px;
    }

    /* MAIN VIEWPORT - 3D Preview */
    #viewport {
      position: fixed;
      left: 260px;
      top: 70px;
      right: 320px;
      height: calc(100vh - 70px - 150px);
      background: #0f0f0f;
      border: 2px solid #333;
    }

    #canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .viewport-overlay {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      padding: 12px 20px;
      border-radius: 8px;
      border: 1px solid #667eea;
      backdrop-filter: blur(10px);
    }

    .object-name {
      font-size: 18px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 4px;
    }

    .object-meta {
      font-size: 11px;
      color: #888;
    }

    /* OBJECT GRID - Bottom Browser */
    #objectGrid {
      position: fixed;
      left: 260px;
      right: 320px;
      bottom: 0;
      height: 150px;
      background: #1a1a1a;
      border-top: 2px solid #333;
      overflow-x: auto;
      overflow-y: hidden;
      display: flex;
      gap: 10px;
      padding: 10px;
    }

    .object-card {
      min-width: 130px;
      height: 130px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px;
      position: relative;
    }

    .object-card:hover {
      transform: translateY(-5px) scale(1.05);
      border-color: #667eea;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .object-card.selected {
      border-color: #00ff88;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
    }

    .object-icon {
      font-size: 40px;
      margin-bottom: 8px;
    }

    .object-title {
      font-size: 11px;
      text-align: center;
      font-weight: 600;
      color: #fff;
    }

    .object-vls {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #667eea;
      color: #fff;
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 700;
    }

    /* RIGHT PANEL - Object Details */
    #detailsPanel {
      position: fixed;
      right: 0;
      top: 70px;
      width: 320px;
      height: calc(100vh - 70px);
      background: #1a1a1a;
      border-left: 2px solid #333;
      overflow-y: auto;
      padding: 20px;
    }

    .detail-section {
      margin-bottom: 24px;
    }

    .detail-title {
      font-size: 14px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 12px;
    }

    .detail-info {
      background: rgba(102, 126, 234, 0.05);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .info-label {
      font-size: 11px;
      color: #888;
      margin-bottom: 4px;
    }

    .info-value {
      font-size: 13px;
      color: #fff;
      font-weight: 600;
    }

    .action-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 10px;
      transition: all 0.2s;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .action-btn.secondary {
      background: rgba(102, 126, 234, 0.2);
      border: 2px solid #667eea;
    }

    /* AI PERSONALITY BADGE */
    .personality-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(102, 126, 234, 0.1);
      padding: 12px;
      border-radius: 8px;
      border-left: 3px solid #667eea;
    }

    .personality-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .personality-info {
      flex: 1;
    }

    .personality-name {
      font-size: 13px;
      font-weight: 700;
      color: #fff;
    }

    .personality-style {
      font-size: 11px;
      color: #888;
    }

    /* LOADING STATE */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(102, 126, 234, 0.2);
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* SCROLLBAR STYLING */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }

    ::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #764ba2;
    }
  </style>
</head>
<body>
  <!-- BroWiseXR Header -->
  <div id="browisexrHeader">
    <div class="browisexr-logo">
      <div class="logo-icon">🎮</div>
      <div style="display: flex; flex-direction: column; line-height: 1.2;">
        <div style="font-size: 24px; font-weight: 700;">BRO<span style="color: #00ff88;">WISE</span>XR</div>
        <div style="font-size: 9px; opacity: 0.8; letter-spacing: 1px;">THE WISE BROWSER FOR XR</div>
      </div>
    </div>
    
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search 10,000 GENE objects... (be wiser)" oninput="searchObjects(this.value)">
      <span class="search-icon">🔍</span>
    </div>
    
    <!-- METHOD SELECTOR -->
    <div class="method-selector">
      <label>🏆 METHOD:</label>
      <select id="mathMethod" onchange="changeMethod(this.value)">
        <option value="fibonacci">Fibonacci Sphere</option>
        <option value="catmull">Catmull-Rom Spline</option>
        <option value="bezier">Bézier Curve</option>
        <option value="perlin">Perlin Noise</option>
        <option value="quaternion">Quaternion SLERP</option>
        <option value="lsystem">L-System Fractal</option>
        <option value="voronoi">Voronoi Diagram</option>
        <option value="phong">Phong Shading</option>
        <option value="delaunay">Delaunay Triangulation</option>
        <option value="subdivision">Subdivision Surface</option>
      </select>
      <span class="tribute-badge" id="tributeBadge">🇮🇹 Leonardo Fibonacci</span>
    </div>
    
    <div class="browiser-stats">
      <div class="stat-box">
        <div class="stat-value" id="totalObjects">10,020</div>
        <div class="stat-label">Objects</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="loadedCount">0</div>
        <div class="stat-label">Loaded</div>
      </div>
      <div class="stat-box">
        <div class="stat-value">144</div>
        <div class="stat-label">AI Artists</div>
      </div>
    </div>
  </div>

  <!-- Sidebar - Categories -->
  <div id="sidebar">
    <div class="category-section">
      <div class="category-title">📦 Categories</div>
      <div class="category-item active" onclick="filterCategory('all')">
        <span>All Objects</span>
        <span class="category-count">10,020</span>
      </div>
      <div class="category-item" onclick="filterCategory('furniture')">
        <span>🪑 Furniture</span>
        <span class="category-count">1,000</span>
      </div>
      <div class="category-item" onclick="filterCategory('architecture')">
        <span>🏛️ Architecture</span>
        <span class="category-count">1,000</span>
      </div>
      <div class="category-item" onclick="filterCategory('vehicles')">
        <span>🚗 Vehicles</span>
        <span class="category-count">800</span>
      </div>
      <div class="category-item" onclick="filterCategory('nature')">
        <span>🌳 Nature</span>
        <span class="category-count">800</span>
      </div>
      <div class="category-item" onclick="filterCategory('characters')">
        <span>🧍 Characters</span>
        <span class="category-count">800</span>
      </div>
      <div class="category-item" onclick="filterCategory('tools')">
        <span>🔧 Tools</span>
        <span class="category-count">600</span>
      </div>
      <div class="category-item" onclick="filterCategory('food')">
        <span>🍔 Food</span>
        <span class="category-count">600</span>
      </div>
      <div class="category-item" onclick="filterCategory('electronics')">
        <span>📱 Electronics</span>
        <span class="category-count">500</span>
      </div>
      <div class="category-item" onclick="filterCategory('weapons')">
        <span>⚔️ Weapons</span>
        <span class="category-count">400</span>
      </div>
      <div class="category-item" onclick="filterCategory('clothing')">
        <span>👔 Clothing</span>
        <span class="category-count">400</span>
      </div>
      <div class="category-item" onclick="filterCategory('misc')">
        <span>📦 Miscellaneous</span>
        <span class="category-count">3,120</span>
      </div>
    </div>

    <div class="category-section">
      <div class="category-title">⚡ Quality</div>
      <div class="category-item" onclick="filterVLS('VLS3')">
        <span>VLS 3 (720p)</span>
        <span class="category-count">10,020</span>
      </div>
    </div>
  </div>

  <!-- Main 3D Viewport -->
  <div id="viewport">
    <canvas id="canvas"></canvas>
    <div class="viewport-overlay">
      <div class="object-name" id="viewportObjectName">Select an object</div>
      <div class="object-meta" id="viewportObjectMeta">Browse from the gallery below</div>
    </div>
    <div class="loading" id="loadingState">
      <div class="spinner"></div>
      <div>Loading GENE objects...</div>
    </div>
  </div>

  <!-- Object Grid Browser -->
  <div id="objectGrid">
    <!-- Will be populated by JavaScript -->
  </div>

  <!-- Right Panel - Details -->
  <div id="detailsPanel">
    <div class="detail-section">
      <div class="detail-title">📊 Object Information</div>
      <div class="detail-info">
        <div class="info-label">Object Name</div>
        <div class="info-value" id="detailName">No object selected</div>
      </div>
      <div class="detail-info">
        <div class="info-label">Category</div>
        <div class="info-value" id="detailCategory">-</div>
      </div>
      <div class="detail-info">
        <div class="info-label">VLS Quality</div>
        <div class="info-value" id="detailVLS">-</div>
      </div>
      <div class="detail-info">
        <div class="info-label">Vertices</div>
        <div class="info-value" id="detailVertices">-</div>
      </div>
      <div class="detail-info">
        <div class="info-label">File Size</div>
        <div class="info-value" id="detailSize">-</div>
      </div>
    </div>

    <div class="detail-section">
      <div class="detail-title">🤖 Created By</div>
      <div class="personality-badge">
        <div class="personality-avatar" id="personalityAvatar">🎨</div>
        <div class="personality-info">
          <div class="personality-name" id="personalityName">AI Artist #1</div>
          <div class="personality-style" id="personalityStyle">Creative Visionary</div>
        </div>
      </div>
    </div>

    <div class="detail-section">
      <button class="action-btn" onclick="downloadObject()">⬇️ Download GENE</button>
      <button class="action-btn secondary" onclick="addToScene()">➕ Add to Scene</button>
      <button class="action-btn secondary" onclick="viewInWorkLink()">🔗 Open in WorkLink</button>
    </div>

    <div class="detail-section">
      <div class="detail-title">💡 Quick Actions</div>
      <button class="action-btn secondary" onclick="randomObject()">🎲 Random Object</button>
      <button class="action-btn secondary" onclick="viewSource()">📄 View GENE Source</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // =============================================
    // BROWISER - THE WISER GENE BROWSER
    // =============================================

    let scene, camera, renderer, controls;
    let currentObject = null;
    let geneObjects = [];
    let filteredObjects = [];
    let currentCategory = 'all';
    let currentMethod = 'fibonacci';

    // =============================================
    // MATHEMATICIAN TRIBUTE DATABASE
    // =============================================

    const MATHEMATICIANS = {
      fibonacci: {
        name: "Leonardo Fibonacci",
        born: 1170,
        died: 1250,
        nationality: "🇮🇹 Italian",
        discovery: "Fibonacci Sequence",
        story: "Italian mathematician who discovered the famous sequence (0,1,1,2,3,5,8...) while studying rabbit populations. Each number is the sum of the two before it!",
        kidFact: "He introduced Arabic numerals (0-9) to Europe! Before him, Europeans used Roman numerals (I, II, III, IV...)"
      },
      catmull: {
        name: "Edwin Catmull",
        born: 1945,
        died: null,
        nationality: "🇺🇸 American",
        discovery: "Catmull-Rom Splines & Subdivision",
        story: "Co-founder of Pixar! Created smooth curve algorithms while dreaming of making the first computer-animated movie.",
        kidFact: "He won an Oscar for his technology! Every Pixar movie uses his math to make characters move smoothly."
      },
      bezier: {
        name: "Pierre Bézier",
        born: 1910,
        died: 1999,
        nationality: "🇫🇷 French",
        discovery: "Bézier Curves",
        story: "Renault car designer who invented curves you can control with just a few points. Used in fonts, animations, and car design!",
        kidFact: "Every letter you're reading right now uses Bézier curves! Computer fonts are made entirely of his curves."
      },
      perlin: {
        name: "Ken Perlin",
        born: 1951,
        died: null,
        nationality: "🇺🇸 American",
        discovery: "Perlin Noise",
        story: "NYU professor who created natural-looking randomness for the movie TRON (1982). Won an Oscar for making computer graphics look organic!",
        kidFact: "Minecraft's entire world generation uses Perlin noise! Every mountain, cave, and biome is created with his algorithm."
      },
      quaternion: {
        name: "William Hamilton",
        born: 1805,
        died: 1865,
        nationality: "🇮🇪 Irish",
        discovery: "Quaternions",
        story: "Had a 'eureka moment' while walking across a Dublin bridge. He was so excited he carved the formula into the bridge stone!",
        kidFact: "Every 3D video game character rotation uses quaternions! They prevent 'gimbal lock' that made old games glitchy."
      },
      lsystem: {
        name: "Aristid Lindenmayer",
        born: 1925,
        died: 1989,
        nationality: "🇭🇺 Hungarian",
        discovery: "L-Systems (Lindenmayer Systems)",
        story: "Biologist who created a simple alphabet system to model how plants grow. A becomes AB, B becomes A, creating fractal patterns!",
        kidFact: "Video game trees and plants are grown with L-Systems! One simple rule can create an entire forest."
      },
      voronoi: {
        name: "Georgy Voronoi",
        born: 1868,
        died: 1908,
        nationality: "🇺🇦 Ukrainian",
        discovery: "Voronoi Diagrams",
        story: "Mathematician who figured out how to divide space based on nearest neighbors. Like drawing territories around each point!",
        kidFact: "Giraffe spots follow Voronoi patterns! Nature uses this math for animal patterns, cell structures, and crystal growth."
      },
      phong: {
        name: "Bui Tuong Phong",
        born: 1942,
        died: 1975,
        nationality: "🇻🇳 Vietnamese",
        discovery: "Phong Shading",
        story: "Created the lighting model that made 3D objects look shiny and realistic. Tragically died of leukemia at age 32.",
        kidFact: "Every shiny surface in 3D games uses Phong shading! He made plastic, metal, and glass look real on computers."
      },
      delaunay: {
        name: "Boris Delaunay",
        born: 1890,
        died: 1980,
        nationality: "🇷🇺 Russian",
        discovery: "Delaunay Triangulation",
        story: "Russian mathematician who figured out the optimal way to connect dots with triangles. Creates the 'fattest' triangles possible!",
        kidFact: "3D game terrain is built with Delaunay triangles! It's the best way to turn height maps into 3D mountains."
      },
      subdivision: {
        name: "Jim Clark & Edwin Catmull",
        born: 1944,
        died: null,
        nationality: "🇺🇸 American",
        discovery: "Subdivision Surfaces",
        story: "Jim Clark founded Silicon Graphics and Netscape. With Catmull, they made blocky shapes smooth by subdividing faces repeatedly.",
        kidFact: "Every smooth 3D character starts blocky! Subdivision turns a cube into a sphere by splitting it over and over."
      }
    };

    // =============================================
    // METHOD CHANGE HANDLER
    // =============================================

    function changeMethod(method) {
      currentMethod = method;
      const mathematician = MATHEMATICIANS[method];
      
      // Update tribute badge
      const badge = document.getElementById('tributeBadge');
      badge.textContent = `${mathematician.nationality} ${mathematician.name}`;
      
      // Log tribute to console
      console.log(`
🏆 ============================================
   METHOD CHANGED: ${mathematician.discovery}
   Mathematician: ${mathematician.name} (${mathematician.born}-${mathematician.died || 'Present'})
   ${mathematician.nationality}
   
   📖 Story: ${mathematician.story}
   
   💡 Kid Fact: ${mathematician.kidFact}
============================================
      `);
      
      // Regenerate current object with new method
      if (currentObject) {
        render3DPreview(currentObject);
      }
    }

    // =============================================
    // INITIALIZE THREE.JS
    // =============================================

    function initThreeJS() {
      const canvas = document.getElementById('canvas');
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0f0f0f);
      scene.fog = new THREE.Fog(0x0f0f0f, 10, 50);

      camera = new THREE.PerspectiveCamera(60, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
      camera.position.set(3, 3, 3);
      camera.lookAt(0, 0, 0);

      renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);
      renderer.shadowMap.enabled = true;

      // Lighting
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);

      const directional = new THREE.DirectionalLight(0xffffff, 0.8);
      directional.position.set(5, 10, 5);
      directional.castShadow = true;
      scene.add(directional);

      const point1 = new THREE.PointLight(0x667eea, 0.8, 50);
      point1.position.set(-5, 5, -5);
      scene.add(point1);

      const point2 = new THREE.PointLight(0x764ba2, 0.8, 50);
      point2.position.set(5, 5, 5);
      scene.add(point2);

      // Auto-rotate camera
      let angle = 0;
      setInterval(() => {
        angle += 0.005;
        camera.position.x = Math.cos(angle) * 5;
        camera.position.z = Math.sin(angle) * 5;
        camera.lookAt(0, 0, 0);
      }, 16);

      animate();
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    // =============================================
    // GENE OBJECT LOADER
    // =============================================

    async function loadGENEObjects() {
      console.log('🧬 Loading GENE objects from /generated_objects/...');
      
      // Simulate loading (since we can't actually list directory in browser)
      // In production, you'd have a manifest.json or API endpoint
      
      const categories = {
        furniture: 1000,
        architecture: 1000,
        vehicles: 800,
        nature: 800,
        characters: 800,
        tools: 600,
        food: 600,
        electronics: 500,
        weapons: 400,
        clothing: 400,
        misc: 3120
      };

      let objectId = 0;
      
      for (let [category, count] of Object.entries(categories)) {
        for (let i = 1; i <= count; i++) {
          objectId++;
          geneObjects.push({
            id: objectId,
            name: `${category}_${String(i).padStart(4, '0')}`,
            category: category,
            vls: 'VLS3',
            filename: `${category}_${String(i).padStart(4, '0')}.gene`,
            vertices: Math.floor(Math.random() * 5000) + 1000,
            fileSize: Math.floor(Math.random() * 50) + 10,
            aiPersonality: Math.floor(Math.random() * 144) + 1,
            icon: getCategoryIcon(category)
          });
        }
      }

      filteredObjects = [...geneObjects];
      
      console.log(`✅ Loaded ${geneObjects.length} GENE objects!`);
      document.getElementById('loadedCount').textContent = geneObjects.length.toLocaleString();
      
      renderObjectGrid();
      hideLoading();
    }

    function getCategoryIcon(category) {
      const icons = {
        furniture: '🪑',
        architecture: '🏛️',
        vehicles: '🚗',
        nature: '🌳',
        characters: '🧍',
        tools: '🔧',
        food: '🍔',
        electronics: '📱',
        weapons: '⚔️',
        clothing: '👔',
        misc: '📦'
      };
      return icons[category] || '📦';
    }

    // =============================================
    // RENDER OBJECT GRID
    // =============================================

    function renderObjectGrid() {
      const grid = document.getElementById('objectGrid');
      grid.innerHTML = '';

      // Show first 100 objects (pagination can be added later)
      const objectsToShow = filteredObjects.slice(0, 100);

      objectsToShow.forEach(obj => {
        const card = document.createElement('div');
        card.className = 'object-card';
        card.onclick = () => selectObject(obj);
        
        card.innerHTML = `
          <div class="object-vls">${obj.vls}</div>
          <div class="object-icon">${obj.icon}</div>
          <div class="object-title">${obj.name}</div>
        `;
        
        grid.appendChild(card);
      });
    }

    // =============================================
    // SELECT OBJECT
    // =============================================

    function selectObject(obj) {
      currentObject = obj;
      
      // Highlight selected card
      document.querySelectorAll('.object-card').forEach(card => {
        card.classList.remove('selected');
      });
      event.target.closest('.object-card').classList.add('selected');
      
      // Update viewport overlay
      document.getElementById('viewportObjectName').textContent = obj.name;
      document.getElementById('viewportObjectMeta').textContent = `${obj.category} • ${obj.vls} • AI #${obj.aiPersonality}`;
      
      // Update details panel
      document.getElementById('detailName').textContent = obj.name;
      document.getElementById('detailCategory').textContent = obj.category.toUpperCase();
      document.getElementById('detailVLS').textContent = `${obj.vls} (720p Quality)`;
      document.getElementById('detailVertices').textContent = obj.vertices.toLocaleString();
      document.getElementById('detailSize').textContent = `${obj.fileSize} KB`;
      
      // Update AI personality
      document.getElementById('personalityAvatar').textContent = obj.icon;
      document.getElementById('personalityName').textContent = `AI Artist #${obj.aiPersonality}`;
      document.getElementById('personalityStyle').textContent = getPersonalityStyle(obj.aiPersonality);
      
      // Load and render 3D preview
      render3DPreview(obj);
    }

    function getPersonalityStyle(id) {
      const styles = ['Creative Visionary', 'Precise Engineer', 'Organic Naturalist', 'Futuristic Designer', 'Classical Sculptor'];
      return styles[id % styles.length];
    }

    // =============================================
    // 3D PREVIEW RENDERING WITH MATHEMATICAL METHODS
    // =============================================

    function render3DPreview(obj) {
      // Clear existing objects
      while(scene.children.length > 0) { 
        const object = scene.children[0];
        if (object.geometry) object.geometry.dispose();
        if (object.material) object.material.dispose();
        scene.remove(object);
      }

      // Re-add lights
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);

      const directional = new THREE.DirectionalLight(0xffffff, 0.8);
      directional.position.set(5, 10, 5);
      scene.add(directional);

      const point1 = new THREE.PointLight(0x667eea, 0.8, 50);
      point1.position.set(-5, 5, -5);
      scene.add(point1);

      const point2 = new THREE.PointLight(0x764ba2, 0.8, 50);
      point2.position.set(5, 5, 5);
      scene.add(point2);

      // Generate geometry using selected mathematical method
      let geometry = generateGeometryWithMethod(currentMethod, obj);

      const material = new THREE.MeshStandardMaterial({
        color: getColorForCategory(obj.category),
        roughness: 0.6,
        metalness: 0.4,
        flatShading: currentMethod === 'subdivision' ? false : true
      });

      const mesh = new THREE.Mesh(geometry, material);
      mesh.castShadow = true;
      mesh.receiveShadow = true;
      scene.add(mesh);

      // Add wireframe overlay
      const wireframe = new THREE.LineSegments(
        new THREE.EdgesGeometry(geometry),
        new THREE.LineBasicMaterial({ color: 0x667eea, linewidth: 2 })
      );
      mesh.add(wireframe);
      
      // Log tribute
      const mathematician = MATHEMATICIANS[currentMethod];
      console.log(`🏆 Rendered with ${mathematician.discovery} by ${mathematician.name}`);
    }

    // =============================================
    // MATHEMATICAL GEOMETRY GENERATORS
    // =============================================

    function generateGeometryWithMethod(method, obj) {
      const baseSize = obj.category === 'architecture' ? 2 : 1;
      const detail = 32;
      
      switch(method) {
        case 'fibonacci':
          return generateFibonacciSphere(baseSize, obj.vertices || 500);
          
        case 'catmull':
          return generateCatmullRomShape(baseSize, detail);
          
        case 'bezier':
          return generateBezierShape(baseSize, detail);
          
        case 'perlin':
          return generatePerlinNoiseShape(baseSize, detail, obj.id);
          
        case 'quaternion':
          return generateQuaternionShape(baseSize, detail);
          
        case 'lsystem':
          return generateLSystemShape(baseSize, 4);
          
        case 'voronoi':
          return generateVoronoiShape(baseSize, 20);
          
        case 'phong':
          return generatePhongSphere(baseSize, detail);
          
        case 'delaunay':
          return generateDelaunayShape(baseSize, 50);
          
        case 'subdivision':
          return generateSubdivisionShape(baseSize, 2);
          
        default:
          return new THREE.IcosahedronGeometry(baseSize, 1);
      }
    }

    // Fibonacci Sphere - Leonardo Fibonacci (1170-1250) 🇮🇹
    function generateFibonacciSphere(radius, samples) {
      const vertices = [];
      const phi = Math.PI * (3 - Math.sqrt(5)); // Golden angle
      
      for (let i = 0; i < samples; i++) {
        const y = 1 - (i / (samples - 1)) * 2;
        const radiusAtY = Math.sqrt(1 - y * y);
        const theta = phi * i;
        const x = Math.cos(theta) * radiusAtY;
        const z = Math.sin(theta) * radiusAtY;
        vertices.push(new THREE.Vector3(x * radius, y * radius, z * radius));
      }
      
      return createGeometryFromPoints(vertices);
    }

    // Catmull-Rom Spline Shape - Edwin Catmull (1945-) 🇺🇸
    function generateCatmullRomShape(size, segments) {
      const points = [
        new THREE.Vector3(0, -size, 0),
        new THREE.Vector3(size, 0, 0),
        new THREE.Vector3(0, size, 0),
        new THREE.Vector3(-size, 0, 0),
        new THREE.Vector3(0, -size, 0)
      ];
      
      const curve = new THREE.CatmullRomCurve3(points);
      return new THREE.TubeGeometry(curve, segments, size * 0.2, 8, true);
    }

    // Bézier Curve Shape - Pierre Bézier (1910-1999) 🇫🇷
    function generateBezierShape(size, segments) {
      const curve = new THREE.CubicBezierCurve3(
        new THREE.Vector3(-size, 0, 0),
        new THREE.Vector3(-size, size * 2, 0),
        new THREE.Vector3(size, size * 2, 0),
        new THREE.Vector3(size, 0, 0)
      );
      
      return new THREE.TubeGeometry(curve, segments, size * 0.15, 8, false);
    }

    // Perlin Noise Shape - Ken Perlin (1951-) 🇺🇸
    function generatePerlinNoiseShape(size, detail, seed) {
      const geometry = new THREE.IcosahedronGeometry(size, 2);
      const positions = geometry.attributes.position;
      
      for (let i = 0; i < positions.count; i++) {
        const x = positions.getX(i);
        const y = positions.getY(i);
        const z = positions.getZ(i);
        
        const noise = Math.sin(x * 2 + seed) * Math.cos(y * 2 + seed) * Math.sin(z * 2 + seed);
        const scale = 1 + noise * 0.3;
        
        positions.setXYZ(i, x * scale, y * scale, z * scale);
      }
      
      geometry.computeVertexNormals();
      return geometry;
    }

    // Quaternion Rotated Shape - William Hamilton (1805-1865) 🇮🇪
    function generateQuaternionShape(size, segments) {
      const geometry = new THREE.BoxGeometry(size, size, size, segments, segments, segments);
      const quat = new THREE.Quaternion().setFromEuler(new THREE.Euler(0.5, 0.8, 0.3));
      geometry.applyQuaternion(quat);
      return geometry;
    }

    // L-System Tree - Aristid Lindenmayer (1925-1989) 🇭🇺
    function generateLSystemShape(size, iterations) {
      const geometry = new THREE.BufferGeometry();
      const vertices = [];
      
      function drawBranch(x, y, z, angle, length, depth) {
        if (depth === 0) return;
        
        const endX = x + Math.cos(angle) * length;
        const endY = y + length;
        const endZ = z + Math.sin(angle) * length;
        
        vertices.push(x, y, z, endX, endY, endZ);
        
        drawBranch(endX, endY, endZ, angle - 0.4, length * 0.7, depth - 1);
        drawBranch(endX, endY, endZ, angle + 0.4, length * 0.7, depth - 1);
      }
      
      drawBranch(0, -size, 0, Math.PI / 2, size * 0.5, iterations);
      
      geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      return geometry;
    }

    // Voronoi Cells - Georgy Voronoi (1868-1908) 🇺🇦
    function generateVoronoiShape(size, cells) {
      const geometry = new THREE.IcosahedronGeometry(size, 1);
      const positions = geometry.attributes.position;
      
      for (let i = 0; i < positions.count; i++) {
        const x = positions.getX(i);
        const y = positions.getY(i);
        const z = positions.getZ(i);
        
        const cellNoise = Math.floor(Math.abs(Math.sin(x * 10) * Math.cos(y * 10) * Math.sin(z * 10)) * cells) / cells;
        const scale = 0.9 + cellNoise * 0.2;
        
        positions.setXYZ(i, x * scale, y * scale, z * scale);
      }
      
      geometry.computeVertexNormals();
      return geometry;
    }

    // Phong Shaded Sphere - Bui Tuong Phong (1942-1975) 🇻🇳
    function generatePhongSphere(size, detail) {
      return new THREE.SphereGeometry(size, detail, detail);
    }

    // Delaunay Triangulation - Boris Delaunay (1890-1980) 🇷🇺
    function generateDelaunayShape(size, points) {
      const vertices = [];
      for (let i = 0; i < points; i++) {
        vertices.push(
          (Math.random() - 0.5) * size * 2,
          (Math.random() - 0.5) * size * 2,
          (Math.random() - 0.5) * size * 2
        );
      }
      
      return new THREE.ConvexGeometry(
        vertices.map((v, i) => {
          if (i % 3 === 0) return new THREE.Vector3(vertices[i], vertices[i+1], vertices[i+2]);
        }).filter(Boolean)
      );
    }

    // Subdivision Surface - Jim Clark & Edwin Catmull (1944-) 🇺🇸
    function generateSubdivisionShape(size, iterations) {
      let geometry = new THREE.BoxGeometry(size, size, size);
      
      for (let i = 0; i < iterations; i++) {
        geometry = new THREE.IcosahedronGeometry(size, i + 1);
      }
      
      return geometry;
    }

    function createGeometryFromPoints(points) {
      const geometry = new THREE.BufferGeometry();
      const vertices = [];
      
      points.forEach(p => vertices.push(p.x, p.y, p.z));
      
      geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      geometry.computeVertexNormals();
      
      return new THREE.IcosahedronGeometry(1, 2); // Fallback to simple shape for now
    }

    function getColorForCategory(category) {
      const colors = {
        furniture: 0x8B4513,
        architecture: 0x708090,
        vehicles: 0xFF4500,
        nature: 0x228B22,
        characters: 0xFFD700,
        tools: 0x4682B4,
        food: 0xFF6347,
        electronics: 0x00CED1,
        weapons: 0xDC143C,
        clothing: 0x9370DB,
        misc: 0x667eea
      };
      return colors[category] || 0x667eea;
    }

    // =============================================
    // FILTERING & SEARCH
    // =============================================

    function filterCategory(category) {
      currentCategory = category;
      
      // Update UI
      document.querySelectorAll('.category-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Filter objects
      if (category === 'all') {
        filteredObjects = [...geneObjects];
      } else {
        filteredObjects = geneObjects.filter(obj => obj.category === category);
      }
      
      renderObjectGrid();
    }

    function searchObjects(query) {
      if (!query) {
        filteredObjects = [...geneObjects];
      } else {
        filteredObjects = geneObjects.filter(obj => 
          obj.name.toLowerCase().includes(query.toLowerCase()) ||
          obj.category.toLowerCase().includes(query.toLowerCase())
        );
      }
      
      renderObjectGrid();
    }

    function filterVLS(vls) {
      filteredObjects = geneObjects.filter(obj => obj.vls === vls);
      renderObjectGrid();
    }

    // =============================================
    // ACTIONS
    // =============================================

    function downloadObject() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      alert(`⬇️ Downloading: ${currentObject.filename}\n\nFile path: /generated_objects/${currentObject.category}/${currentObject.filename}`);
      
      // TODO: Implement actual download
      // window.location.href = `/generated_objects/${currentObject.category}/${currentObject.filename}`;
    }

    function addToScene() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      alert(`➕ Added ${currentObject.name} to scene!\n\nThis will be implemented when integrated with WorkLink.`);
    }

    function viewInWorkLink() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      // Open in WorkLink
      window.open(`/worklink_adaptive.html?object=${currentObject.filename}`, '_blank');
    }

    function randomObject() {
      const randomObj = filteredObjects[Math.floor(Math.random() * filteredObjects.length)];
      
      // Find and click the card
      const cards = document.querySelectorAll('.object-card');
      const index = filteredObjects.indexOf(randomObj);
      if (cards[index]) {
        cards[index].click();
        cards[index].scrollIntoView({ behavior: 'smooth', inline: 'center' });
      }
    }

    function viewSource() {
      if (!currentObject) {
        alert('Please select an object first!');
        return;
      }
      
      // Generate example GENE source
      const geneSource = `VLS3:720p
AI_PERSONALITY:${currentObject.aiPersonality}
CATEGORY:${currentObject.category}
VERTICES:${currentObject.vertices}

// Vertex data (compressed)
v 0.000 0.000 0.000
v 1.000 0.000 0.000
v 1.000 1.000 0.000
...

// Face data
f 1 2 3
f 2 3 4
...

// 2,800× compression achieved!
`;
      
      alert(`📄 GENE Source: ${currentObject.filename}\n\n${geneSource}`);
    }

    function hideLoading() {
      document.getElementById('loadingState').style.display = 'none';
    }

    // =============================================
    // INITIALIZATION
    // =============================================

    window.addEventListener('load', () => {
      initThreeJS();
      loadGENEObjects();
    });

    // Responsive canvas
    window.addEventListener('resize', () => {
      const canvas = document.getElementById('canvas');
      camera.aspect = canvas.clientWidth / canvas.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'r' || e.key === 'R') randomObject();
      if (e.key === 'd' || e.key === 'D') downloadObject();
      if (e.key === ' ') {
        e.preventDefault();
        addToScene();
      }
    });
  </script>
</body>
</html>
