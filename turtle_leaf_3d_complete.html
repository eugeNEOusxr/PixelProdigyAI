<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turtle Leaf to 3D - Complete System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            overflow: hidden;
        }
        
        #container {
            display: flex;
            width: 100vw;
            height: 100vh;
        }
        
        #turtle-canvas {
            width: 50%;
            background: #000;
            border-right: 3px solid #00ff00;
        }
        
        #webgl-container {
            width: 50%;
            background: #0a0a15;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
            z-index: 1000;
        }
        
        h2 {
            color: #00ffff;
            margin-bottom: 10px;
            text-align: center;
        }
        
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #00ffff;
            transform: scale(1.05);
        }
        
        select {
            background: #000;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 8px;
            margin: 5px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            font-size: 11px;
            max-width: 300px;
        }
        
        .stat {
            padding: 3px 0;
            border-bottom: 1px solid #333;
        }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="turtle-canvas"></canvas>
        <div id="webgl-container"></div>
    </div>
    
    <div id="controls">
        <h2>üê¢ TURTLE LEAF ‚Üí 3D CONVERTER</h2>
        <div>
            <select id="leaf-pattern">
                <option value="oak">Oak Leaf</option>
                <option value="maple">Maple Leaf</option>
                <option value="fern">Fern Leaf</option>
                <option value="spiral">Spiral Leaf</option>
            </select>
            <button id="draw-btn">Draw Leaf</button>
            <button id="convert-3d-btn">Convert to 3D</button>
            <button id="clear-btn">Clear</button>
        </div>
    </div>
    
    <div id="info">
        <div class="stat">Turtle Steps: <span id="turtle-steps">0</span></div>
        <div class="stat">3D Vertices: <span id="vertices-count">0</span></div>
        <div class="stat">3D Triangles: <span id="triangles-count">0</span></div>
        <div class="stat">Leaf Thickness: <span id="thickness">0.02</span></div>
    </div>

    <script src="https://unpkg.com/three@0.152.0/build/three.min.js"></script>
    
    <script>
        // ===== TURTLE GRAPHICS SYSTEM =====
        class MyTurtle {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.reset();
            }
            
            reset() {
                this.x = this.canvas.width / 2;
                this.y = this.canvas.height / 2;
                this.angle = -90; // Start pointing up
                this.penDown = true;
                this.path = [];
                this.color = '#00ff00';
                this.lineWidth = 2;
                
                // Clear canvas
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Add starting point to path
                this.path.push({x: this.x, y: this.y});
            }
            
            forward(distance) {
                const radians = this.angle * Math.PI / 180;
                const newX = this.x + distance * Math.cos(radians);
                const newY = this.y + distance * Math.sin(radians);
                
                if (this.penDown) {
                    this.ctx.strokeStyle = this.color;
                    this.ctx.lineWidth = this.lineWidth;
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.x, this.y);
                    this.ctx.lineTo(newX, newY);
                    this.ctx.stroke();
                    
                    this.path.push({x: newX, y: newY});
                }
                
                this.x = newX;
                this.y = newY;
            }
            
            backward(distance) {
                this.forward(-distance);
            }
            
            left(degrees) {
                this.angle -= degrees;
            }
            
            right(degrees) {
                this.angle += degrees;
            }
            
            penup() {
                this.penDown = false;
            }
            
            pendown() {
                this.penDown = true;
            }
            
            setColor(color) {
                this.color = color;
            }
            
            setWidth(width) {
                this.lineWidth = width;
            }
            
            getPath() {
                return this.path;
            }
        }
        
        // ===== LEAF DRAWING PATTERNS =====
        const leafPatterns = {
            oak: (turtle) => {
                // Oak leaf with lobes
                turtle.setColor('#00ff00');
                const size = 80;
                
                // Right side
                for (let i = 0; i < 3; i++) {
                    turtle.forward(size / 3);
                    turtle.right(30);
                    turtle.forward(size / 6);
                    turtle.backward(size / 6);
                    turtle.left(30);
                }
                turtle.forward(size / 3);
                
                // Tip
                turtle.right(45);
                turtle.forward(size / 4);
                turtle.right(90);
                turtle.forward(size / 4);
                turtle.right(45);
                
                // Left side
                for (let i = 0; i < 3; i++) {
                    turtle.forward(size / 3);
                    turtle.left(30);
                    turtle.forward(size / 6);
                    turtle.backward(size / 6);
                    turtle.right(30);
                }
            },
            
            maple: (turtle) => {
                // Maple leaf with 5 points
                turtle.setColor('#ff8800');
                const size = 60;
                
                // Draw 5 pointed sections
                for (let i = 0; i < 5; i++) {
                    turtle.forward(size);
                    turtle.right(140);
                    turtle.forward(size * 0.7);
                    turtle.left(70);
                    turtle.forward(size * 0.7);
                    turtle.right(140);
                    turtle.forward(size);
                    turtle.left(72);
                }
            },
            
            fern: (turtle) => {
                // Fern-like fractal leaf
                turtle.setColor('#00aa00');
                
                function drawFern(length, angle, depth) {
                    if (depth === 0) {
                        turtle.forward(length);
                        return;
                    }
                    
                    // Draw main stem
                    turtle.forward(length / 3);
                    
                    // Right branch
                    turtle.right(angle);
                    drawFern(length / 2, angle, depth - 1);
                    turtle.left(angle);
                    
                    turtle.forward(length / 3);
                    
                    // Left branch
                    turtle.left(angle);
                    drawFern(length / 2, angle, depth - 1);
                    turtle.right(angle);
                    
                    turtle.forward(length / 3);
                }
                
                drawFern(150, 25, 3);
            },
            
            spiral: (turtle) => {
                // Spiral leaf pattern
                turtle.setColor('#00ffff');
                let distance = 2;
                
                for (let i = 0; i < 180; i++) {
                    turtle.forward(distance);
                    turtle.right(10);
                    distance += 0.3;
                }
            }
        };
        
        // ===== 3D CONVERSION SYSTEM =====
        class LeafTo3DConverter {
            constructor() {
                this.thickness = 0.02;
            }
            
            convert(path2D, canvasWidth, canvasHeight) {
                // Normalize path to -1 to 1 coordinates
                const normalized = this.normalizePath(path2D, canvasWidth, canvasHeight);
                
                // Create top and bottom surfaces
                const topVertices = [];
                const bottomVertices = [];
                
                for (const point of normalized) {
                    topVertices.push(point.x, this.thickness / 2, point.y);
                    bottomVertices.push(point.x, -this.thickness / 2, point.y);
                }
                
                // Create triangular mesh
                const vertices = [];
                const indices = [];
                const colors = [];
                
                let vertexIndex = 0;
                
                // Add all vertices
                for (let i = 0; i < topVertices.length; i += 3) {
                    vertices.push(topVertices[i], topVertices[i + 1], topVertices[i + 2]);
                    colors.push(0.2, 0.8, 0.2); // Green
                }
                for (let i = 0; i < bottomVertices.length; i += 3) {
                    vertices.push(bottomVertices[i], bottomVertices[i + 1], bottomVertices[i + 2]);
                    colors.push(0.15, 0.6, 0.15); // Darker green
                }
                
                const topStart = 0;
                const bottomStart = topVertices.length / 3;
                const pointCount = bottomStart;
                
                // Top surface triangles (fan from first vertex)
                for (let i = 1; i < pointCount - 1; i++) {
                    indices.push(topStart, topStart + i + 1, topStart + i);
                }
                
                // Bottom surface triangles (fan from first vertex)
                for (let i = 1; i < pointCount - 1; i++) {
                    indices.push(bottomStart, bottomStart + i, bottomStart + i + 1);
                }
                
                // Side edges - connect top and bottom
                for (let i = 0; i < pointCount - 1; i++) {
                    const t1 = topStart + i;
                    const t2 = topStart + i + 1;
                    const b1 = bottomStart + i;
                    const b2 = bottomStart + i + 1;
                    
                    // Two triangles for each edge segment
                    indices.push(t1, b1, t2);
                    indices.push(t2, b1, b2);
                }
                
                // Close the loop
                const lastTop = topStart + pointCount - 1;
                const lastBottom = bottomStart + pointCount - 1;
                indices.push(lastTop, lastBottom, topStart);
                indices.push(topStart, lastBottom, bottomStart);
                
                return {
                    vertices: new Float32Array(vertices),
                    indices: new Uint32Array(indices),
                    colors: new Float32Array(colors)
                };
            }
            
            normalizePath(path, width, height) {
                // Find bounding box
                let minX = Infinity, maxX = -Infinity;
                let minY = Infinity, maxY = -Infinity;
                
                for (const p of path) {
                    minX = Math.min(minX, p.x);
                    maxX = Math.max(maxX, p.x);
                    minY = Math.min(minY, p.y);
                    maxY = Math.max(maxY, p.y);
                }
                
                // Normalize to -1 to 1
                const normalized = [];
                for (const p of path) {
                    const nx = ((p.x - minX) / (maxX - minX) * 2 - 1) * 0.8;
                    const ny = ((p.y - minY) / (maxY - minY) * 2 - 1) * 0.8;
                    normalized.push({x: nx, y: ny});
                }
                
                return normalized;
            }
        }
        
        // ===== SETUP =====
        const turtleCanvas = document.getElementById('turtle-canvas');
        turtleCanvas.width = window.innerWidth / 2;
        turtleCanvas.height = window.innerHeight;
        
        const turtle = new MyTurtle(turtleCanvas);
        const converter = new LeafTo3DConverter();
        
        // THREE.js setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a15);
        
        const camera = new THREE.PerspectiveCamera(
            75,
            (window.innerWidth / 2) / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(0, 1, 2);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth / 2, window.innerHeight);
        document.getElementById('webgl-container').appendChild(renderer.domElement);
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        let leafMesh = null;
        
        // ===== CONTROLS =====
        document.getElementById('draw-btn').addEventListener('click', () => {
            turtle.reset();
            const pattern = document.getElementById('leaf-pattern').value;
            leafPatterns[pattern](turtle);
            
            const path = turtle.getPath();
            document.getElementById('turtle-steps').textContent = path.length;
        });
        
        document.getElementById('convert-3d-btn').addEventListener('click', () => {
            const path = turtle.getPath();
            if (path.length < 3) {
                alert('Draw a leaf first!');
                return;
            }
            
            // Remove old mesh
            if (leafMesh) {
                scene.remove(leafMesh);
            }
            
            // Convert to 3D
            const geometryData = converter.convert(
                path,
                turtleCanvas.width,
                turtleCanvas.height
            );
            
            // Create THREE.js geometry
            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(geometryData.vertices, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(geometryData.colors, 3));
            geometry.setIndex(new THREE.BufferAttribute(geometryData.indices, 1));
            geometry.computeVertexNormals();
            
            // Create material
            const material = new THREE.MeshStandardMaterial({
                vertexColors: true,
                side: THREE.DoubleSide,
                roughness: 0.8,
                metalness: 0.2
            });
            
            // Create mesh
            leafMesh = new THREE.Mesh(geometry, material);
            scene.add(leafMesh);
            
            // Update stats
            document.getElementById('vertices-count').textContent = 
                (geometryData.vertices.length / 3).toLocaleString();
            document.getElementById('triangles-count').textContent = 
                (geometryData.indices.length / 3).toLocaleString();
            
            console.log('‚úÖ Leaf converted to 3D!');
            console.log('Vertices:', geometryData.vertices.length / 3);
            console.log('Triangles:', geometryData.indices.length / 3);
        });
        
        document.getElementById('clear-btn').addEventListener('click', () => {
            turtle.reset();
            if (leafMesh) {
                scene.remove(leafMesh);
                leafMesh = null;
            }
            document.getElementById('turtle-steps').textContent = '0';
            document.getElementById('vertices-count').textContent = '0';
            document.getElementById('triangles-count').textContent = '0';
        });
        
        // Auto-rotate 3D view
        function animate() {
            requestAnimationFrame(animate);
            
            if (leafMesh) {
                leafMesh.rotation.y += 0.01;
                leafMesh.rotation.x = Math.sin(Date.now() * 0.001) * 0.2;
            }
            
            renderer.render(scene, camera);
        }
        
        animate();
        
        // Window resize
        window.addEventListener('resize', () => {
            turtleCanvas.width = window.innerWidth / 2;
            turtleCanvas.height = window.innerHeight;
            
            camera.aspect = (window.innerWidth / 2) / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth / 2, window.innerHeight);
        });
        
        console.log('üê¢ Turtle Leaf to 3D System Ready!');
        console.log('1. Select a leaf pattern');
        console.log('2. Click "Draw Leaf" to draw with turtle graphics');
        console.log('3. Click "Convert to 3D" to create 3D geometry with thickness');
    </script>
</body>
</html>
