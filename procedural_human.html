<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Procedural Human — EugeneousOS</title>
  <style>
    html,body { height:100%; margin:0; font-family:Inter,Segoe UI,Roboto,Arial; overflow:hidden }
    #info { position: absolute; left: 20px; bottom: 20px; z-index: 10; background: rgba(0,0,0,0.7); color: #fff; padding:15px; border-radius:8px; font-size:14px }
    #renderer { width:100%; height:100%; display:block }
    .controls { position: absolute; right: 20px; top: 20px; z-index: 10; background: rgba(0,0,0,0.7); color: #fff; padding:10px; border-radius:8px; font-size:12px }
    button { padding:6px 12px; margin:2px; border-radius:4px; border:none; cursor:pointer; background:#333; color:#fff }
    button:hover { background:#555 }
  </style>
</head>
<body>
  <div id="info">
    <strong>3D Human Model</strong><br>
    Mouse: Rotate • Wheel: Zoom • Right-click: Pan
  </div>
  
  <div class="controls">
    <button id="exportGLB">Export GLB</button>
  </div>

  <canvas id="renderer"></canvas>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.128.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.128.0/examples/jsm/controls/OrbitControls.js';
    import { GLTFExporter } from 'https://unpkg.com/three@0.128.0/examples/jsm/exporters/GLTFExporter.js';

    const canvas = document.getElementById('renderer');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111217);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0,1.6,3.5);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.target.set(0,1,0);
    controls.update();

    const hemi = new THREE.HemisphereLight(0xbfd1ff, 0x444444, 0.6);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.9);
    dir.position.set(3,8,5);
    dir.castShadow = true;
    scene.add(dir);

    // ground
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshStandardMaterial({ color:0x0b0b0f, metalness:0.1, roughness:0.9 }));
    ground.rotation.x = -Math.PI/2; ground.position.y = 0; scene.add(ground);

    // Human group
    const humanGroup = new THREE.Group();
    scene.add(humanGroup);

    // Materials
    const skinMat = new THREE.MeshStandardMaterial({ 
      color: 0xf4a574, 
      metalness: 0.02, 
      roughness: 0.8,
      normalScale: new THREE.Vector2(0.3, 0.3)
    });
    
    const hairMat = new THREE.MeshStandardMaterial({ color: 0x3d2914, roughness: 0.9 });
    const eyeMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a, roughness: 0.3 });
    const lipMat = new THREE.MeshStandardMaterial({ color: 0xb85450, roughness: 0.6 });

    function createDetailedHuman() {
      // More realistic proportions (1.75m tall human)
      const H = 1.75;
      const headH = 0.23;
      const neckH = 0.08;
      const torsoH = 0.66;
      const armL = 0.62;
      const legL = 0.9;
      
      // HEAD - more detailed
      const headGeo = new THREE.SphereGeometry(headH/2.2, 24, 16);
      const head = new THREE.Mesh(headGeo, skinMat);
      head.position.set(0, legL + torsoH + neckH + headH/2.2, 0);
      head.scale.set(0.95, 1.1, 0.9); // more human head shape
      head.castShadow = true;
      humanGroup.add(head);

      // NECK
      const neckGeo = new THREE.CylinderGeometry(0.065, 0.075, neckH, 12);
      const neck = new THREE.Mesh(neckGeo, skinMat);
      neck.position.set(0, legL + torsoH + neckH/2, 0);
      neck.castShadow = true;
      humanGroup.add(neck);

      // FACIAL FEATURES
      // Eyes
      const eyeGeo = new THREE.SphereGeometry(0.018, 12, 8);
      const leftEye = new THREE.Mesh(eyeGeo, eyeMat);
      leftEye.position.set(-0.035, head.position.y + 0.02, 0.09);
      const rightEye = leftEye.clone();
      rightEye.position.x = 0.035;
      humanGroup.add(leftEye, rightEye);

      // Nose
      const noseGeo = new THREE.ConeGeometry(0.012, 0.04, 8);
      const nose = new THREE.Mesh(noseGeo, skinMat);
      nose.position.set(0, head.position.y - 0.015, 0.095);
      nose.rotation.x = Math.PI;
      nose.castShadow = true;
      humanGroup.add(nose);

      // Mouth
      const mouthGeo = new THREE.CapsuleGeometry(0.008, 0.025, 4, 8);
      const mouth = new THREE.Mesh(mouthGeo, lipMat);
      mouth.position.set(0, head.position.y - 0.05, 0.085);
      mouth.rotation.z = Math.PI/2;
      humanGroup.add(mouth);

      // Hair
      const hairGeo = new THREE.SphereGeometry(headH/2.1, 16, 12, 0, Math.PI*2, 0, Math.PI*0.6);
      const hair = new THREE.Mesh(hairGeo, hairMat);
      hair.position.copy(head.position);
      hair.position.y += 0.02;
      hair.scale.set(1.05, 0.8, 1.02);
      hair.castShadow = true;
      humanGroup.add(hair);

      // TORSO - more anatomical
      const chestGeo = new THREE.CapsuleGeometry(0.18, torsoH*0.6, 12, 20);
      const chest = new THREE.Mesh(chestGeo, skinMat);
      chest.position.set(0, legL + torsoH*0.7, 0);
      chest.scale.set(1.2, 1, 0.7); // broader shoulders, flatter
      chest.castShadow = true;
      humanGroup.add(chest);

      // Lower torso/abdomen
      const abdomenGeo = new THREE.CylinderGeometry(0.16, 0.19, torsoH*0.4, 16);
      const abdomen = new THREE.Mesh(abdomenGeo, skinMat);
      abdomen.position.set(0, legL + torsoH*0.2, 0);
      abdomen.castShadow = true;
      humanGroup.add(abdomen);

      // ARMS - more realistic
      function createArm(side) {
        const armGroup = new THREE.Group();
        
        // Shoulder
        const shoulderGeo = new THREE.SphereGeometry(0.08, 12, 8);
        const shoulder = new THREE.Mesh(shoulderGeo, skinMat);
        shoulder.position.set(side * 0.25, legL + torsoH - 0.1, 0);
        shoulder.castShadow = true;
        humanGroup.add(shoulder);
        
        // Upper arm
        const upperArmGeo = new THREE.CapsuleGeometry(0.055, armL*0.55, 10, 12);
        const upperArm = new THREE.Mesh(upperArmGeo, skinMat);
        upperArm.position.set(side * 0.25, legL + torsoH - 0.1 - armL*0.55/2, 0);
        upperArm.castShadow = true;
        humanGroup.add(upperArm);
        
        // Elbow
        const elbowGeo = new THREE.SphereGeometry(0.04, 10, 8);
        const elbow = new THREE.Mesh(elbowGeo, skinMat);
        elbow.position.set(side * 0.25, legL + torsoH - 0.1 - armL*0.55, 0);
        elbow.castShadow = true;
        humanGroup.add(elbow);
        
        // Forearm
        const forearmGeo = new THREE.CapsuleGeometry(0.045, armL*0.45, 10, 12);
        const forearm = new THREE.Mesh(forearmGeo, skinMat);
        forearm.position.set(side * 0.25, legL + torsoH - 0.1 - armL*0.55 - armL*0.45/2, 0);
        forearm.castShadow = true;
        humanGroup.add(forearm);
        
        // Hand
        const handGeo = new THREE.BoxGeometry(0.08, 0.12, 0.04);
        const hand = new THREE.Mesh(handGeo, skinMat);
        hand.position.set(side * 0.25, legL + torsoH - 0.1 - armL - 0.06, 0);
        hand.castShadow = true;
        humanGroup.add(hand);
        
        // Fingers
        for(let i = 0; i < 4; i++) {
          const fingerGeo = new THREE.CylinderGeometry(0.008, 0.006, 0.04, 6);
          const finger = new THREE.Mesh(fingerGeo, skinMat);
          finger.position.set(
            side * 0.25 + (i - 1.5) * 0.015, 
            hand.position.y - 0.08, 
            0.02
          );
          finger.castShadow = true;
          humanGroup.add(finger);
        }
      }
      
      createArm(1);  // right arm
      createArm(-1); // left arm

      // LEGS - more realistic
      function createLeg(side) {
        // Hip
        const hipGeo = new THREE.SphereGeometry(0.09, 12, 8);
        const hip = new THREE.Mesh(hipGeo, skinMat);
        hip.position.set(side * 0.12, legL, 0);
        hip.castShadow = true;
        humanGroup.add(hip);
        
        // Thigh
        const thighGeo = new THREE.CapsuleGeometry(0.08, legL*0.55, 12, 16);
        const thigh = new THREE.Mesh(thighGeo, skinMat);
        thigh.position.set(side * 0.12, legL - legL*0.55/2, 0);
        thigh.castShadow = true;
        humanGroup.add(thigh);
        
        // Knee
        const kneeGeo = new THREE.SphereGeometry(0.055, 10, 8);
        const knee = new THREE.Mesh(kneeGeo, skinMat);
        knee.position.set(side * 0.12, legL - legL*0.55, 0);
        knee.castShadow = true;
        humanGroup.add(knee);
        
        // Calf
        const calfGeo = new THREE.CapsuleGeometry(0.06, legL*0.45, 12, 16);
        const calf = new THREE.Mesh(calfGeo, skinMat);
        calf.position.set(side * 0.12, legL - legL*0.55 - legL*0.45/2, 0);
        calf.castShadow = true;
        humanGroup.add(calf);
        
        // Foot
        const footGeo = new THREE.BoxGeometry(0.1, 0.06, 0.25);
        const foot = new THREE.Mesh(footGeo, skinMat);
        foot.position.set(side * 0.12, 0.03, 0.08);
        foot.castShadow = true;
        humanGroup.add(foot);
      }
      
      createLeg(1);  // right leg
      createLeg(-1); // left leg

      // Set all meshes to cast and receive shadows
      humanGroup.traverse((child) => {
        if (child.isMesh) {
          child.castShadow = true;
          child.receiveShadow = true;
        }
      });
    }

    // Create the detailed human
    createDetailedHuman();

    // Simple UI helper
    function $(id){return document.getElementById(id)}

    // Export GLB
    $('exportGLB').addEventListener('click', () => {
      const exporter = new GLTFExporter();
      const options = { binary:true };
      exporter.parse(humanGroup, (result) => {
        if (result instanceof ArrayBuffer) {
          saveArrayBuffer(result, 'procedural_human.glb');
        } else {
          const text = JSON.stringify(result, null, 2);
          saveString(text, 'procedural_human.gltf');
        }
      }, options);
    });

    function saveString(text, filename) {
      const link = document.createElement('a');
      link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(text);
      link.download = filename;
      link.click();
    }
    function saveArrayBuffer(buffer, filename) {
      const blob = new Blob([buffer], {type:'application/octet-stream'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }

    // resize
    window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });

    // animation
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    animate();

    console.log('3D Human loaded - use mouse to rotate, wheel to zoom');

  </script>
</body>
</html>